var ae=Object.defineProperty;var se=(r,s,i)=>s in r?ae(r,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[s]=i;var w=(r,s,i)=>se(r,typeof s!="symbol"?s+"":s,i);import{models as S,useModels as L,query as P,t as b,createPinia as oe,init as re}from"@oxylus/ox";import{OxAutocomplete as W,OxModelEdit as G,OxField as h,OxModelPanel as J,App as ie}from"@oxylus/ox/components";import{defineComponent as x,useSlots as N,useAttrs as T,useModel as F,createBlock as v,openBlock as _,unref as n,mergeProps as g,createSlots as U,withCtx as l,createVNode as o,normalizeProps as O,guardReactiveProps as $,createElementVNode as B,toDisplayString as m,createTextVNode as y,renderList as j,renderSlot as A,mergeModels as K,ref as ue,computed as z,watch as Z,createElementBlock as E,Fragment as ce,createCommentVNode as de}from"vue";import{V as Q,a as me,b as R,c as pe,d as X,e as I}from"./vuetify.js";class M extends S.Model{static fields(){return{id:this.attr(null),name:this.string(),code:this.string(),numeric:this.string(),decimals:this.number(),is_iso:this.boolean(),valid_to:this.string(null)}}}w(M,"entity","currencies"),w(M,"meta",new S.Meta({app:"ox_locations",model:"currency",url:"ox/locations/currency/",title:"name"}));class C extends S.Model{static fields(){return{id:this.attr(null),name:this.string(),code:this.string(),code_3:this.string(),phone:this.number(),continent:this.number(),currency_code:this.string(),currency:this.string(),iban_sample:this.string(),iban_length:this.number(),$currency:this.belongsTo(M,"currency")}}get flag(){if(typeof this.code!="string"||this.code.length!==2)return"";const s=127462,i=this.code.toUpperCase().split("");return i.every(u=>u>="A"&&u<="Z")?String.fromCodePoint(...i.map(u=>s+u.charCodeAt(0)-65)):""}}w(C,"entity","countries"),w(C,"meta",new S.Meta({app:"ox_locations",model:"country",url:"ox/locations/country/",title:"name"})),w(C,"_continentItems"),w(C,"Continent",S.Enum("continent",{AFRICA:1,ANTARCTICA:2,ASIA:3,EUROPE:4,NORTH_AMERICA:5,OCEANIA:6,SOUTH_AMERICA:7}));function q(){return L([C,M],{withDefaults:!1})}function _e(){const{countries:r}=L([C],{withDefaults:!1});return{countries:r}}function Y(){const{currencies:r}=L([M],{withDefaults:!1});return{currencies:r}}const fe={class:"mr-2"},he={class:"mr-2"},ye=x({__name:"OxCountryInput",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(r){const s=N(),i=T(),c=F(r,"modelValue"),u=_e();return(t,d)=>(_(),v(n(W),g({repo:n(u).countries,lookup:"name__icontains","item-value":"id","item-title":"name",modelValue:c.value,"onUpdate:modelValue":d[0]||(d[0]=e=>c.value=e)},n(i)),U({selection:l(({item:e})=>[B("span",fe,m(e.raw.flag),1),y(" "+m(e.raw.name),1)]),item:l(({props:e,item:a})=>[o(Q,O($(e)),{prepend:l(()=>[B("span",he,m(a.raw.flag),1)]),_:2},1040)]),_:2},[j(n(s),(e,a)=>({name:a,fn:l(k=>[A(t.$slots,a,O($(k)))])}))]),1040,["repo","modelValue"]))}}),ve={key:0,class:"v-messages"},ge={key:0},Ve={key:1,class:"text-warning"},be=x({__name:"OxIbanInput",props:K({label:String},{modelValue:{type:String,default:""},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const{countries:s,currencies:i}=q();P(s).allOnce(),P(i).allOnce();const c=r,u=F(r,"modelValue"),t=ue(""),d=z(()=>u.value.length>=2?u.value.substring(0,2).toUpperCase():""),e=z(()=>d.value&&s.where("code",d.value).with("$currency").first()||null);Z(t,(f,p)=>{if(f!=p){const V=a(f);u.value!=V&&(u.value=V)}}),Z(u,(f,p)=>{if(f!=p){const V=k(f);t.value!=V&&(t.value=V)}});function a(f){return f.replace(/\s+/g,"").toUpperCase()}function k(f){var p;return((p=f.replace(/\s+/g,"").replace(/[^A-Z0-9]/gi,"").toUpperCase().match(/.{1,4}/g))==null?void 0:p.join(" "))||""}function ne(f){var H;const p=f.replace(/\s+/g,"").toUpperCase();if((H=e.value)==null||H.iban_length,p.length<15)return b("fields.iban.too_short");const le=(p.slice(4)+p.slice(0,4)).split("").map(D=>isNaN(D)?D.charCodeAt(0)-55:D).join("");return BigInt(le)%97n===1n||b("fields.iban.invalid_checksum")}return(f,p)=>(_(),E(ce,null,[o(me,{modelValue:t.value,"onUpdate:modelValue":p[0]||(p[0]=V=>t.value=V),label:c.label||"IBAN",rules:[ne]},U({_:2},[e.value?{name:"prepend-inner",fn:l(()=>[y(m(e.value.flag),1)]),key:"0"}:void 0,e.value&&e.value.$currency?{name:"append",fn:l(()=>[y(m(e.value.$currency.code),1)]),key:"1"}:void 0]),1032,["modelValue","label","rules"]),e.value?(_(),E("p",ve,[e.value.iban_sample?(_(),E("div",ge,[o(R,{icon:"mdi-help-circle-outline"}),y(" "+m(n(b)("fields.iban.help",{name:e.value.name,sample:e.value.iban_sample||"..."})),1)])):(_(),E("div",Ve,[o(R,{icon:"mdi-alert-circle-outline"}),y(" "+m(n(b)("fields.iban.country_without_iban",{name:e.value.name})),1)]))])):de("",!0)],64))}}),xe={class:"ml-2"},we={class:"ml-2"},ee=x({__name:"OxCurrencyInput",props:K({label:String,name:String,multiple:Boolean,hideDetails:Boolean,density:String,rules:Array},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const s=N(),i=r,c=F(r,"modelValue"),u=Y();return(t,d)=>(_(),v(n(W),g({repo:n(u).currencies,lookup:"name__icontains","item-value":"id","item-title":"name",modelValue:c.value,"onUpdate:modelValue":d[0]||(d[0]=e=>c.value=e)},i),U({selection:l(({item:e,index:a})=>[y(m(e.raw.name)+" ",1),B("span",xe,m(e.code),1)]),item:l(({props:e,item:a})=>[o(Q,O($(e)),{append:l(()=>[B("span",we,m(a.raw.code),1)]),_:2},1040)]),_:2},[j(n(s),e=>({name:e,fn:l(a=>[A(t.$slots,e,O($(a)))])}))]),1040,["repo","modelValue"]))}}),te=x({__name:"OxContinentInput",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(r){const s=F(r,"modelValue"),i=T();return(c,u)=>(_(),v(pe,g({modelValue:s.value,"onUpdate:modelValue":u[0]||(u[0]=t=>s.value=t)},n(i),{placeholder:n(b)("fields.continent"),items:n(C).Continent.items}),{detail:l(t=>[A(c.$slots,"detail",O($(t)))]),_:3},16,["modelValue","placeholder","items"]))}}),Ce=x({__name:"OxCountryEdit",setup(r){const s=q(),i=T();return(c,u)=>(_(),v(n(G),g({ref:"model-editor"},n(i),{repo:n(s).countries}),{default:l(({editor:t,editable:d})=>[o(X,null,{default:l(()=>[y(m(t.value.flag)+" ",1),o(I,null,{default:l(()=>[o(n(h),{editor:t,name:"name",required:""},null,8,["editor"])]),_:2},1024),o(I,{cols:"2"},{default:l(()=>[o(n(h),{editor:t,name:"code",required:""},null,8,["editor"])]),_:2},1024),o(I,{cols:"2"},{default:l(()=>[o(n(h),{editor:t,name:"code_3",required:""},null,8,["editor"])]),_:2},1024)]),_:2},1024),o(n(h),{editor:t,name:"continent"},{default:l(({props:e})=>[o(te,g(e,{modelValue:t.value.continent,"onUpdate:modelValue":a=>t.value.continent=a}),null,16,["modelValue","onUpdate:modelValue"])]),_:2},1032,["editor"]),o(n(h),{editor:t,name:"phone","prepend-icon":"mdi-phone"},null,8,["editor"]),o(n(h),{editor:t,name:"currency"},{default:l(({props:e})=>[o(n(ee),g(e,{modelValue:t.value.currency,"onUpdate:modelValue":a=>t.value.currency=a}),null,16,["modelValue","onUpdate:modelValue"])]),_:2},1032,["editor"])]),_:1},16,["repo"]))}}),Oe=x({__name:"OxCountryPanel",props:{repo:{},view:{},headers:{default:["name","code","code_3","phone","currency"]},relations:{default:["$currency"]},showFilters:{type:Boolean},fetchRelations:{type:Boolean,default:!1},search:{},warning:{},index:{},value:{},state:{},help:{},name:{default:"countries"},title:{},icon:{}},setup(r){const s=N(),i=Object.keys(s).filter(t=>!["list.filters","top"].includes(t)),c=q();P(c.currencies).allOnce();const u=r;return(t,d)=>(_(),v(n(J),g(u,{repo:n(c).countries,warning:n(b)("alerts.danger_zone_system_data")}),U({"list.filters":l(({list:e,filters:a})=>[o(n(te),{class:"ml-3",density:"compact","hide-details":"",modelValue:a.continent,"onUpdate:modelValue":k=>a.continent=k,label:n(b)("fields.continent")},null,8,["modelValue","onUpdate:modelValue","label"]),A(t.$slots,"list.filters",{list:e,filters:a})]),"views.detail.edit.default":l(({value:e,saved:a})=>[o(n(Ce),{initial:e,saved:a},null,8,["initial","saved"])]),_:2},[j(n(i),e=>({name:e,fn:l(a=>[A(t.$slots,e,O($(a)))])})),n(s)["item.name"]?void 0:{name:"item.name",fn:l(({item:e})=>[y(m(e.flag)+" "+m(e.name),1)]),key:"0"},n(s)["item.currency"]?void 0:{name:"item.currency",fn:l(({item:e})=>{var a;return[y(m((a=e.$currency)==null?void 0:a.code),1)]}),key:"1"}]),1040,["repo","warning"]))}}),$e=x({__name:"OxCurrencyEdit",setup(r){const s=Y(),i=T();return(c,u)=>(_(),v(n(G),g(n(i),{repo:n(s).currencies}),{default:l(({editor:t})=>[o(X,null,{default:l(()=>[o(I,null,{default:l(()=>[o(n(h),{editor:t,name:"name",required:""},null,8,["editor"])]),_:2},1024),o(I,{cols:"2"},{default:l(()=>[o(n(h),{editor:t,name:"code",required:""},null,8,["editor"])]),_:2},1024),o(I,{cols:"2"},{default:l(()=>[o(n(h),{editor:t,name:"numeric"},null,8,["editor"])]),_:2},1024)]),_:2},1024),o(n(h),{editor:t,name:"is_iso",type:"checkbox"},null,8,["editor"]),o(n(h),{editor:t,name:"valid_to",type:"date"},null,8,["editor"])]),_:1},16,["repo"]))}}),Ae=x({__name:"OxCurrencyPanel",props:{repo:{},view:{},headers:{default:["name","code","numeric","is_iso","valid_to"]},relations:{},showFilters:{type:Boolean},fetchRelations:{type:Boolean},search:{},warning:{},index:{},value:{},state:{},help:{},name:{default:"currencies"},title:{},icon:{}},setup(r){const s=N(),i=Object.keys(s).filter(t=>!["list.filters","top"].includes(t)),c=q();P(c.currencies).allOnce(),z(()=>[{title:"Without group",value:null},...groups.value.map(t=>({title:t.name,value:t.id}))]);const u=r;return(t,d)=>(_(),v(n(J),g(u,{repo:n(c).currencies,warning:n(b)("alerts.danger_zone_system_data")}),U({"list.filters":l(({list:e,filters:a})=>[A(t.$slots,"list.filters",{list:e,filters:a})]),"item.is_iso":l(({item:e})=>[e.is_iso?(_(),v(R,{key:0,class:"text-success"},{default:l(()=>[...d[0]||(d[0]=[y("mdi-check-circle",-1)])]),_:1})):(_(),v(R,{key:1,class:"text-error"},{default:l(()=>[...d[1]||(d[1]=[y("mdi-close-circle",-1)])]),_:1}))]),"views.detail.edit.default":l(({value:e,saved:a})=>[o($e,{initial:e,saved:a},null,8,["initial","saved"])]),_:2},[j(n(i),e=>({name:e,fn:l(a=>[A(t.$slots,e,O($(a)))])}))]),1040,["repo","warning"]))}}),Ie=Object.freeze(Object.defineProperty({__proto__:null,OxCountryInput:ye,OxCountryPanel:Oe,OxCurrencyInput:ee,OxCurrencyPanel:Ae,OxIbanInput:be},Symbol.toStringTag,{value:"Module"})),ke={extends:ie,components:Ie},Se=oe();re({App:ke,plugins:[Se]});
//# sourceMappingURL=index.js.map
