var ae=Object.defineProperty;var se=(o,r,i)=>r in o?ae(o,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[r]=i;var b=(o,r,i)=>se(o,typeof r!="symbol"?r+"":r,i);import{models as S,useModels as L,query as P,t as x,createPinia as oe,init as re}from"@oxylus/ox";import{OxAutocomplete as W,OxModelEdit as G,OxField as y,OxModelPanel as J,App as ie}from"@oxylus/ox/components";import{defineComponent as w,useSlots as N,useAttrs as T,useModel as F,createBlock as v,openBlock as _,unref as n,mergeProps as g,createSlots as U,withCtx as l,createVNode as s,normalizeProps as O,guardReactiveProps as $,createElementVNode as B,toDisplayString as m,createTextVNode as h,renderList as j,renderSlot as A,mergeModels as K,ref as ue,computed as z,watch as Z,createElementBlock as E,Fragment as ce,createCommentVNode as de}from"vue";import{V as Q,a as me,b as R,c as pe,d as X,e as I}from"./vuetify.js";class M extends S.Model{static fields(){return{id:this.attr(null),name:this.string(""),code:this.string(""),numeric:this.string(""),decimals:this.number(2),is_iso:this.boolean(!1),valid_to:this.string(null)}}}b(M,"entity","currencies"),b(M,"meta",new S.Meta({app:"ox_locations",model:"currency",url:"ox/locations/currency/",title:"name"}));class C extends S.Model{constructor(){super(...arguments);b(this,"code")}static fields(){return{id:this.attr(null),name:this.string(""),code:this.string(""),code_3:this.string(""),phone:this.number(null),continent:this.number(1),currency_code:this.string(""),currency:this.string(""),iban_sample:this.string(""),iban_length:this.number(34),$currency:this.belongsTo(M,"currency")}}get flag(){if(typeof this.code!="string"||this.code.length!==2)return"";const i=127462,u=this.code.toUpperCase().split("");return u.every(t=>t>="A"&&t<="Z")?String.fromCodePoint(...u.map(t=>i+t.charCodeAt(0)-65)):""}}b(C,"entity","countries"),b(C,"meta",new S.Meta({app:"ox_locations",model:"country",url:"ox/locations/country/",title:"name"})),b(C,"_continentItems"),b(C,"Continent",S.Enum("continent",{AFRICA:1,ANTARCTICA:2,ASIA:3,EUROPE:4,NORTH_AMERICA:5,OCEANIA:6,SOUTH_AMERICA:7}));function q(){return L([C,M],{useDefaults:!1})}function _e(){const{countries:o}=L([C],{useDefaults:!1});return{countries:o}}function Y(){const{currencies:o}=L([M],{useDefaults:!1});return{currencies:o}}const fe={class:"mr-2"},ye={class:"mr-2"},he=w({__name:"OxCountryInput",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(o){const r=N(),i=T(),u=F(o,"modelValue"),c=_e();return(t,d)=>(_(),v(n(W),g({repo:n(c).countries,lookup:"name__icontains","item-value":"id","item-title":"name",modelValue:u.value,"onUpdate:modelValue":d[0]||(d[0]=e=>u.value=e)},n(i)),U({selection:l(({item:e})=>[B("span",fe,m(e.raw.flag),1),h(" "+m(e.raw.name),1)]),item:l(({props:e,item:a})=>[s(Q,O($(e)),{prepend:l(()=>[B("span",ye,m(a.raw.flag),1)]),_:2},1040)]),_:2},[j(n(r),(e,a)=>({name:a,fn:l(k=>[A(t.$slots,a,O($(k)))])}))]),1040,["repo","modelValue"]))}}),ve={key:0,class:"v-messages"},ge={key:0},Ve={key:1,class:"text-warning"},be=w({__name:"OxIbanInput",props:K({label:String},{modelValue:{type:String,default:""},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const{countries:r,currencies:i}=q();P(r).allOnce(),P(i).allOnce();const u=o,c=F(o,"modelValue"),t=ue(""),d=z(()=>c.value.length>=2?c.value.substring(0,2).toUpperCase():""),e=z(()=>d.value&&r.where("code",d.value).with("$currency").first()||null);Z(t,(f,p)=>{if(f!=p){const V=a(f);c.value!=V&&(c.value=V)}}),Z(c,(f,p)=>{if(f!=p){const V=k(f);t.value!=V&&(t.value=V)}});function a(f){return f.replace(/\s+/g,"").toUpperCase()}function k(f){var p;return((p=f.replace(/\s+/g,"").replace(/[^A-Z0-9]/gi,"").toUpperCase().match(/.{1,4}/g))==null?void 0:p.join(" "))||""}function ne(f){var H;const p=f.replace(/\s+/g,"").toUpperCase();if((H=e.value)==null||H.iban_length,p.length<15)return x("fields.iban.too_short");const le=(p.slice(4)+p.slice(0,4)).split("").map(D=>isNaN(D)?D.charCodeAt(0)-55:D).join("");return BigInt(le)%97n===1n||x("fields.iban.invalid_checksum")}return(f,p)=>(_(),E(ce,null,[s(me,{modelValue:t.value,"onUpdate:modelValue":p[0]||(p[0]=V=>t.value=V),label:u.label||"IBAN",rules:[ne]},U({_:2},[e.value?{name:"prepend-inner",fn:l(()=>[h(m(e.value.flag),1)]),key:"0"}:void 0,e.value&&e.value.$currency?{name:"append",fn:l(()=>[h(m(e.value.$currency.code),1)]),key:"1"}:void 0]),1032,["modelValue","label","rules"]),e.value?(_(),E("p",ve,[e.value.iban_sample?(_(),E("div",ge,[s(R,{icon:"mdi-help-circle-outline"}),h(" "+m(n(x)("fields.iban.help",{name:e.value.name,sample:e.value.iban_sample||"..."})),1)])):(_(),E("div",Ve,[s(R,{icon:"mdi-alert-circle-outline"}),h(" "+m(n(x)("fields.iban.country_without_iban",{name:e.value.name})),1)]))])):de("",!0)],64))}}),xe={class:"ml-2"},we={class:"ml-2"},ee=w({__name:"OxCurrencyInput",props:K({label:String,name:String,multiple:Boolean,hideDetails:Boolean,density:String,rules:Array},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const r=N(),i=o,u=F(o,"modelValue"),c=Y();return(t,d)=>(_(),v(n(W),g({repo:n(c).currencies,lookup:"name__icontains","item-value":"id","item-title":"name",modelValue:u.value,"onUpdate:modelValue":d[0]||(d[0]=e=>u.value=e)},i),U({selection:l(({item:e,index:a})=>[h(m(e.raw.name)+" ",1),B("span",xe,m(e.code),1)]),item:l(({props:e,item:a})=>[s(Q,O($(e)),{append:l(()=>[B("span",we,m(a.raw.code),1)]),_:2},1040)]),_:2},[j(n(r),e=>({name:e,fn:l(a=>[A(t.$slots,e,O($(a)))])}))]),1040,["repo","modelValue"]))}}),te=w({__name:"OxContinentInput",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(o){const r=F(o,"modelValue"),i=T();return(u,c)=>(_(),v(pe,g({modelValue:r.value,"onUpdate:modelValue":c[0]||(c[0]=t=>r.value=t)},n(i),{placeholder:n(x)("fields.continent"),items:n(C).Continent.items}),{detail:l(t=>[A(u.$slots,"detail",O($(t)))]),_:3},16,["modelValue","placeholder","items"]))}}),Ce=w({__name:"OxCountryEdit",setup(o){const r=q(),i=T();return(u,c)=>(_(),v(n(G),g({ref:"model-editor"},n(i),{repo:n(r).countries}),{default:l(({editor:t,editable:d})=>[s(X,null,{default:l(()=>[h(m(t.value.flag)+" ",1),s(I,null,{default:l(()=>[s(n(y),{editor:t,name:"name",required:""},null,8,["editor"])]),_:2},1024),s(I,{cols:"2"},{default:l(()=>[s(n(y),{editor:t,name:"code",required:""},null,8,["editor"])]),_:2},1024),s(I,{cols:"2"},{default:l(()=>[s(n(y),{editor:t,name:"code_3",required:""},null,8,["editor"])]),_:2},1024)]),_:2},1024),s(n(y),{editor:t,name:"continent"},{default:l(({props:e})=>[s(te,g(e,{modelValue:t.value.continent,"onUpdate:modelValue":a=>t.value.continent=a}),null,16,["modelValue","onUpdate:modelValue"])]),_:2},1032,["editor"]),s(n(y),{editor:t,name:"phone","prepend-icon":"mdi-phone"},null,8,["editor"]),s(n(y),{editor:t,name:"currency"},{default:l(({props:e})=>[s(ee,g(e,{modelValue:t.value.currency,"onUpdate:modelValue":a=>t.value.currency=a}),null,16,["modelValue","onUpdate:modelValue"])]),_:2},1032,["editor"])]),_:1},16,["repo"]))}}),Oe=w({__name:"OxCountryPanel",props:{repo:{},view:{},headers:{default:["name","code","code_3","phone","currency"]},relations:{default:["$currency"]},showFilters:{type:Boolean},fetchRelations:{type:Boolean,default:!1},search:{},warning:{},index:{},value:{},state:{},help:{},name:{default:"countries"},title:{},icon:{}},setup(o){const r=N(),i=Object.keys(r).filter(t=>!["list.filters","top"].includes(t)),u=q();P(u.currencies).allOnce();const c=o;return(t,d)=>(_(),v(n(J),g(c,{repo:n(u).countries,warning:n(x)("alerts.danger_zone_system_data")}),U({"list.filters":l(({list:e,filters:a})=>[s(te,{class:"ml-3",density:"compact","hide-details":"",modelValue:a.continent,"onUpdate:modelValue":k=>a.continent=k,label:n(x)("fields.continent")},null,8,["modelValue","onUpdate:modelValue","label"]),A(t.$slots,"list.filters",{list:e,filters:a})]),"views.detail.edit.default":l(({value:e,saved:a})=>[s(Ce,{initial:e,saved:a},null,8,["initial","saved"])]),_:2},[j(n(i),e=>({name:e,fn:l(a=>[A(t.$slots,e,O($(a)))])})),n(r)["item.name"]?void 0:{name:"item.name",fn:l(({item:e})=>[h(m(e.flag)+" "+m(e.name),1)]),key:"0"},n(r)["item.currency"]?void 0:{name:"item.currency",fn:l(({item:e})=>{var a;return[h(m((a=e.$currency)==null?void 0:a.code),1)]}),key:"1"}]),1040,["repo","warning"]))}}),$e=w({__name:"OxCurrencyEdit",setup(o){const r=Y(),i=T();return(u,c)=>(_(),v(n(G),g(n(i),{repo:n(r).currencies}),{default:l(({editor:t})=>[s(X,null,{default:l(()=>[s(I,null,{default:l(()=>[s(n(y),{editor:t,name:"name",required:""},null,8,["editor"])]),_:2},1024),s(I,{cols:"2"},{default:l(()=>[s(n(y),{editor:t,name:"code",required:""},null,8,["editor"])]),_:2},1024),s(I,{cols:"2"},{default:l(()=>[s(n(y),{editor:t,name:"numeric"},null,8,["editor"])]),_:2},1024)]),_:2},1024),s(n(y),{editor:t,name:"is_iso",type:"checkbox"},null,8,["editor"]),s(n(y),{editor:t,name:"valid_to",type:"date"},null,8,["editor"])]),_:1},16,["repo"]))}}),Ae=w({__name:"OxCurrencyPanel",props:{repo:{},view:{},headers:{default:["name","code","numeric","is_iso","valid_to"]},relations:{},showFilters:{type:Boolean},fetchRelations:{type:Boolean},search:{},warning:{},index:{},value:{},state:{},help:{},name:{default:"currencies"},title:{},icon:{}},setup(o){const r=N(),i=Object.keys(r).filter(t=>!["list.filters","top"].includes(t)),u=q();P(u.currencies).allOnce(),z(()=>[{title:"Without group",value:null},...groups.value.map(t=>({title:t.name,value:t.id}))]);const c=o;return(t,d)=>(_(),v(n(J),g(c,{repo:n(u).currencies,warning:n(x)("alerts.danger_zone_system_data")}),U({"list.filters":l(({list:e,filters:a})=>[A(t.$slots,"list.filters",{list:e,filters:a})]),"item.is_iso":l(({item:e})=>[e.is_iso?(_(),v(R,{key:0,class:"text-success"},{default:l(()=>[...d[0]||(d[0]=[h("mdi-check-circle",-1)])]),_:1})):(_(),v(R,{key:1,class:"text-error"},{default:l(()=>[...d[1]||(d[1]=[h("mdi-close-circle",-1)])]),_:1}))]),"views.detail.edit.default":l(({value:e,saved:a})=>[s($e,{initial:e,saved:a},null,8,["initial","saved"])]),_:2},[j(n(i),e=>({name:e,fn:l(a=>[A(t.$slots,e,O($(a)))])}))]),1040,["repo","warning"]))}}),Ie=Object.freeze(Object.defineProperty({__proto__:null,OxCountryInput:he,OxCountryPanel:Oe,OxCurrencyInput:ee,OxCurrencyPanel:Ae,OxIbanInput:be},Symbol.toStringTag,{value:"Module"})),ke={extends:ie,components:Ie},Se=oe();re({App:ke,plugins:[Se]});
//# sourceMappingURL=index.js.map
