{"version":3,"file":"index.js","sources":["../src/models/enum.ts","../../../node_modules/.pnpm/@pinia-orm+axios@1.10.2_axios@1.12.2_pinia-orm@1.10.2_pinia@2.3.1_typescript@5.9.3_vue@_be9726b6c1646e67857a0bf5647088fb/node_modules/@pinia-orm/axios/dist/index.mjs","../src/models/repository.ts","../src/models/index.ts","../src/composables/models.ts","../src/composables/app.ts","../src/composables/actions.ts","../src/composables/init.ts","../src/controllers/query.ts","../src/controllers/editor.ts","../src/controllers/panel.ts","../src/controllers/panels.ts","../src/controllers/modelController.ts","../src/controllers/modelList.ts","../src/controllers/modelEditor.ts","../src/controllers/modelPanel.ts","../src/composables/controllers.ts","../src/composables/rules.ts","../src/composables/index.ts"],"sourcesContent":["import { t } from '../composables/i18n'\n\n\n/**\n * Return string label for the provided enum.\n */\nfunction toString(prefix: string, prop: string) {\n    let key = `enums.${prefix}.${prop}`\n    let val = t(key)\n    if(val != key)\n        return val\n\n    return t(`enums.${prefix}._.${prop}`)\n}\n\nexport interface IEnum extends Record<string, any> {\n    __prefix: string\n}\n\n\n/**\n * Provide an enum and utilities for rendering enum in a list.\n * See {@link Enum} function for more informations.\n */\nexport const enumProxy = {\n    get(target: Record<string, any>, prop: string, receiver: IEnum) {\n        if(prop == \"items\")\n            return Object.keys(target).filter(k => k[0] != '_').map(k => ({\n                value: target[k],\n                title: toString(target.__prefix, k)\n            }))\n        if(prop == \"toString\")\n            return (k: string) => toString(receiver.__prefix, k)\n        return Reflect.get(target, prop, receiver)\n    },\n\n}\n\n/**\n * Create a new enum using provided field values.\n *\n * This returns a Proxy that provides the following:\n *\n * - `toString(field: string)`: return translated string for the provided field name\n * - `items`: a list of enumerated values to be used by `v-select` (with `title` and `value`).\n *\n * @param prefix - prefix used in translation, as `enums.{prefix}.{props}`.\n * @param fields - enum fields and values\n */\nexport function Enum(prefix: string, fields: Record<string, any>) {\n    fields.__prefix = prefix\n    return new Proxy(fields, enumProxy)\n}\n","import { Repository, config, useRepo, definePiniaOrmPlugin } from 'pinia-orm';\nimport { getActivePinia } from 'pinia';\n\nclass Response {\n  /**\n   * The repository that called the request.\n   */\n  repository;\n  /**\n   * The request configuration.\n   */\n  config;\n  /**\n   * The axios response instance.\n   */\n  response;\n  /**\n   * Entities created by Pinia ORM.\n   */\n  entities = null;\n  /**\n   * Whether if response data is saved to the store or not.\n   */\n  isSaved = false;\n  /**\n   * Create a new response instance.\n   */\n  constructor(repository, config, response) {\n    this.repository = repository;\n    this.config = config;\n    this.response = response;\n  }\n  /**\n   * Save response data to the store.\n   */\n  async save() {\n    const data = this.getDataFromResponse();\n    if (!this.validateData(data)) {\n      console.warn(\n        \"[Pinia ORM Axios] The response data could not be saved to the store because it is not an object or an array. You might want to use `dataTransformer` option to handle non-array/object response before saving it to the store.\"\n      );\n      return;\n    }\n    let method = this.config.persistBy || \"save\";\n    if (!this.validatePersistAction(method)) {\n      console.warn(\n        '[Pinia ORM Axios] The \"persistBy\" option configured is not a recognized value. Response data will be persisted by the default `save` method.'\n      );\n      method = \"save\";\n    }\n    const result = await this.repository[method](data);\n    this.entities = Array.isArray(result) ? result : [result];\n    this.isSaved = true;\n  }\n  /**\n   * Delete the entity record where the `delete` option is configured.\n   */\n  async delete() {\n    if (this.config.delete === void 0) {\n      throw new Error(\n        \"[Pinia ORM Axios] Could not delete records because the `delete` option is not set.\"\n      );\n    }\n    await this.repository.query().destroy(this.config.delete);\n  }\n  /**\n   * Get the response data from the axios response object. If a `dataTransformer`\n   * option is configured, it will be applied to the response object. If the\n   * `dataKey` option is configured, it will return the data from the given\n   * property within the response body.\n   */\n  getDataFromResponse() {\n    if (this.config.dataTransformer) {\n      return this.config.dataTransformer(this.response);\n    }\n    if (this.config.dataKey) {\n      return this.response.data[this.config.dataKey];\n    }\n    return this.response.data;\n  }\n  /**\n   * Get persist options if any set in config.\n   */\n  // protected getPersistOptions (): PersistOptions | undefined {\n  //   const persistOptions = this.config.persistOptions\n  //\n  //   if (!persistOptions || typeof persistOptions !== 'object') {\n  //     return\n  //   }\n  //\n  //   return Object.keys(persistOptions)\n  //     .filter(this.validatePersistAction) // Filter to avoid polluting the payload.\n  //     .reduce((carry, key) => {\n  //       carry[key] = persistOptions[key]\n  //       return carry\n  //     }, {} as PersistOptions)\n  // }\n  /**\n   * Validate the given data to ensure the Pinia ORM persist methods accept it.\n   */\n  validateData(data) {\n    return data !== null && typeof data === \"object\";\n  }\n  /**\n   * Validate the given string as to ensure it correlates with the available\n   * Pinia ORM persist methods.\n   */\n  validatePersistAction(action) {\n    return [\"save\", \"insert\"].includes(action);\n  }\n}\n\nclass Request {\n  /**\n   * The repository class.\n   */\n  repository;\n  /**\n   * The default config.\n   */\n  config = {\n    save: true\n  };\n  /**\n   * Create a new api instance.\n   */\n  constructor(repository) {\n    this.repository = repository;\n    this.registerActions();\n  }\n  /**\n   * Get the axios client.\n   */\n  get axios() {\n    this.repository.axios = this.repository.axios ?? this.repository.config.axiosApi.axios;\n    if (!this.repository.axios) {\n      throw new Error(\n        \"[Pinia ORM Axios] The axios instance is not registered. Please register the axios instance to the repository.\"\n      );\n    }\n    return this.repository.axios;\n  }\n  /**\n   * Register actions from the repository config.\n   */\n  registerActions() {\n    const actions = { ...this.repository.config.axiosApi?.actions, ...this.repository.getModel().$config()?.axiosApi?.actions };\n    if (!actions) {\n      return;\n    }\n    for (const name in actions) {\n      const action = actions[name];\n      typeof action === \"function\" ? this.registerFunctionAction(name, action) : this.registerObjectAction(name, action);\n    }\n  }\n  /**\n   * Register the given object action.\n   */\n  registerObjectAction(name, action) {\n    this[name] = (config) => {\n      return this.request({ ...action, ...config });\n    };\n  }\n  /**\n   * Register the given function action.\n   */\n  registerFunctionAction(name, action) {\n    this[name] = action.bind(this);\n  }\n  /**\n   * Perform a get request.\n   */\n  get(url, config = {}) {\n    return this.request({ method: \"get\", url, ...config });\n  }\n  /**\n   * Perform a post request.\n   */\n  post(url, data = {}, config = {}) {\n    return this.request({ method: \"post\", url, data, ...config });\n  }\n  /**\n   * Perform a put request.\n   */\n  put(url, data = {}, config = {}) {\n    return this.request({ method: \"put\", url, data, ...config });\n  }\n  /**\n   * Perform a patch request.\n   */\n  patch(url, data = {}, config = {}) {\n    return this.request({ method: \"patch\", url, data, ...config });\n  }\n  /**\n   * Perform a delete request.\n   */\n  delete(url, config = {}) {\n    return this.request({ method: \"delete\", url, ...config });\n  }\n  /**\n   * Perform an api request.\n   */\n  async request(config) {\n    const requestConfig = this.createConfig(config);\n    const axiosResponse = await this.axios.request(requestConfig);\n    return this.createResponse(axiosResponse, requestConfig);\n  }\n  /**\n   * Create a new config by merging the global config, the repository config,\n   * and the given config.\n   */\n  createConfig(config) {\n    return {\n      ...this.config,\n      ...this.repository.globalApiConfig,\n      ...this.repository.apiConfig,\n      ...config\n    };\n  }\n  /**\n   * Create a new response instance by applying a few initialization processes.\n   * For example, it saves response data if `save` option id set to `true`.\n   */\n  async createResponse(axiosResponse, config) {\n    const response = new Response(this.repository, config, axiosResponse);\n    if (config.delete !== void 0) {\n      await response.delete();\n      return response;\n    }\n    config.save && await response.save();\n    return response;\n  }\n}\n\nclass AxiosRepository extends Repository {\n  axios;\n  globalApiConfig;\n  apiConfig;\n  constructor(database, pinia) {\n    super(database, pinia);\n    this.axios = config?.axiosApi?.axios || null;\n    this.globalApiConfig = config?.axiosApi || {};\n    this.apiConfig = {};\n  }\n  api() {\n    return useAxiosApi(this);\n  }\n  setAxios(axios) {\n    this.axios = axios;\n    return this;\n  }\n}\n\nfunction useAxiosApi(repository) {\n  return new Request(repository);\n}\n\nfunction useAxiosRepo(model) {\n  const pinia = getActivePinia();\n  AxiosRepository.useModel = model;\n  return useRepo(AxiosRepository, pinia);\n}\n\nfunction createPiniaOrmAxios(axiosConfig) {\n  return definePiniaOrmPlugin((context) => {\n    context.config.axiosApi = axiosConfig;\n    return context;\n  });\n}\nconst piniaOrmPluginAxios = createPiniaOrmAxios();\n\nexport { AxiosRepository, Request, Response, createPiniaOrmAxios, piniaOrmPluginAxios, useAxiosApi, useAxiosRepo };\n","import type { Database, Repository as $Repository } from 'pinia-orm'\nimport type { Pinia } from 'pinia'\nimport type { ModelId, Model, ModelType } from './model'\n\nimport { difference, pull, union } from 'lodash'\nimport { AxiosRepository } from '@pinia-orm/axios'\n\n\n/**\n * Reference type used to identify an item and owner in the repository.\n */\nexport type RefKey = string|number\n\n\n/**\n * Provide reference count for items, by context key using acquire-release mechanism.\n *\n * This allows to keep memory low by keeping a registry of items being used.\n *\n * A single repository can be used for multiple purpose. The objects handling\n * data acquisition (as {@link ModelList}) will acquire objects keeping reference count.\n *\n * **Remember to always clean before dropping since there is no clean automation\n * from javascript (eg. on\n * components unmount). This is already done by some components as {@link OxModelPanel}.**\n *\n * An object released with not more reference is destroyed from database.\n *\n * **Note**: once an object is tagged as acquired, it will be destroyed on release\n * no matter if there are other use outside of it.\n */\nexport class RefCounter<MT extends ModelType, R extends RefRepository<MT>> {\n    static _lastKey = 0\n\n    repo: R\n\n    /** Acquired items */\n    items: Record<RefKey, RefKey[]>\n\n    constructor(repo: R) {\n        this.repo = repo\n        this.items = {}\n    }\n\n    /** Acquire a unique context key */\n    acquireKey(): number {\n        return RefCounter._lastKey++\n    }\n\n    /** Acquire provided ids for this key */\n    acquire(key: RefKey, ids: RefKey[]) {\n        if(ids?.length)\n            for(var id of ids) {\n                if(id in this.items) {\n                    const tags = this.items[id]\n                    !tags.includes(key) && tags.push(key)\n                }\n                else\n                    this.items[id] = [key]\n            }\n    }\n\n    /** Release provided ids for this key */\n    release(key: RefKey, ids: RefKey[]) {\n        if(!ids?.length)\n            return\n\n        const drop = []\n        for(var id of ids) {\n            const tags = this.items[id]\n            pull(tags, key)\n            if(!tags?.length) {\n                drop.push(id)\n                delete this.items[id]\n            }\n        }\n\n        if(drop.length)\n            this.repo.destroy(drop)\n    }\n\n    /**\n     * Release and acquire for this key.\n     *\n     * This optimizes out ids\n     */\n    releaseAcquire(key: RefKey, releaseIds: RefKey[], acquireIds: RefKey[]) {\n        this.release(key, difference(releaseIds, acquireIds))\n        this.acquire(key, difference(acquireIds, releaseIds))\n    }\n\n    /** Release all reference for the provided context key. */\n    flush(key: RefKey) {\n        const drop = []\n        for(var id in this.items) {\n            const tags = this.items[id]\n            const idx = tags.indexOf(key)\n            if(idx != -1) {\n                tags.splice(idx,1)\n                if(!tags.length) {\n                    drop.push(id)\n                    delete this.items[id]\n                }\n            }\n        }\n\n        if(drop.length)\n            this.repo.destroy(drop)\n    }\n\n    /** Clear reference counter without destroying items. **/\n    clear() {\n        this.items = {}\n    }\n\n}\n\n\n/**\n * This interface shall be used whenever you required Model's features\n * under the repository. It ensure the model fields are available\n */\nexport interface Repository<MT extends ModelType> extends $Repository<InstanceType<MT>> {\n    use?: MT\n}\n\n\n/**\n * Base repository used by Oxylus application.\n *\n * It:\n * - provides a `counter` property: used for object reference tracking\n * - AxiosRepository: used to fetch items from api.\n */\nexport class RefRepository<MT extends ModelType> extends AxiosRepository<InstanceType<MT>> {\n    refs: RefCounter<MT, RefRepository<MT>>\n    declare use?: MT\n\n    constructor(database: Database, pinia?: Pinia) {\n        super(database, pinia)\n        this.refs = new RefCounter(this)\n    }\n\n    flush(): InstanceType<MT>[] {\n        this.refs.clear()\n        return super.flush()\n    }\n}\n","import {Relation, BelongsTo, HasMany, HasManyBy, HasOne} from 'pinia-orm'\nimport type {PrimaryKey, Model as $Model} from 'pinia-orm'\n\nimport type { ClassType } from '../utils'\n\nexport * from './enum'\nexport * from './model'\nexport * from './auth'\nexport * from './repository'\n\nimport type { Model, ModelType } from './model'\nimport type { Repository, RefRepository } from './repository'\n\n/** Record of repositories by model entity. */\nexport type Repos = Record<string, Repository<ModelType>>\n\n/** Record of {@link RefRepository} by model entity. */\nexport type RefRepos = Record<string, RefRepository<ModelType>>\n\n/** Return relation based on field name or Relation field. */\nexport function asRelation<MT extends ModelType>(repo: Repository<MT>, relation: string|Relation): Relation|null {\n    if(typeof relation == \"string\") {\n        const fields = repo.use?.fields()\n        const field = fields && fields[relation] || null\n        relation = field instanceof Relation ? field : null\n    }\n    return relation\n}\n\n/**\n * For the provided relation, return the field name providing ids of related\n * models.\n */\nexport function getSourceKey(field: Relation): PrimaryKey|null  {\n    if(field instanceof HasMany || field instanceof HasManyBy || field instanceof HasOne || field instanceof BelongsTo)\n        return field.foreignKey\n    return null\n}\n","import type {Constructor, Model as $Model} from 'pinia-orm'\nimport { inject, provide } from 'vue'\nimport { getActivePinia } from 'pinia'\nimport { useRepo as $useRepo } from 'pinia-orm'\n\nimport type {ModelType, RefRepos} from '../models'\nimport { User, RefRepository } from '../models'\n\n\nexport type Models = ModelType[] | Record<string, ModelType>\n\n/**\n * {@link useModels} options.\n */\nexport interface IUseModelOpts {\n    /** Use injected repository if already present. */\n    useInject?: boolean\n    /** Use default models */\n    useDefaults?: boolean\n}\n\n\n/**\n * Use repository for the provided model, returning a {@link RefRepository}.\n */\nexport function useRepo<MT extends ModelType>(model: MT): RefRepository<MT> {\n    $useRepo(model)\n    const pinia = getActivePinia()\n    RefRepository.useModel = model as unknown as typeof $Model\n    return $useRepo(RefRepository<MT>, pinia)\n}\n\n/**\n * Use provided pinia-orm models, returning an object with:\n * - repos: pinia-orm api repositories as dict by entity\n * - models: pinia-orm models\n *\n * It uses injected repos by default if already provided. You\n * can disable it through options.\n *\n * `provide()` those values if not already provided.\n */\nexport function useModels(models: Models, {useInject=true, useDefaults=true}: IUseModelOpts = {}): RefRepos\n{\n    var repos : RefRepos = useInject && (inject('repos') || {}) as RefRepos\n    const injected = (useInject && !!Object.keys(repos).length)\n\n    if(!Array.isArray(models))\n       models = Object.values(models)\n\n    if(useDefaults)\n       models.push(User)\n\n    for(const model of models)\n        if(model && model.entity) {\n            if(model.entity in repos)\n                continue\n\n            // there might be a bug here, without useRepo, axios is null on repositories\n            repos[model.entity] = useRepo(model)\n        }\n\n    !injected && provide(\"repos\", repos)\n    return repos\n}\n","import {computed, reactive, provide} from 'vue'\nimport type {ComputedRef, Reactive} from 'vue'\n\nimport {User, Model} from '../models'\nimport type {ModelType, Repos} from '../models'\nimport { useModels } from './models'\nimport { State } from '../utils'\n\n\n/**\n * Interface describing application data.\n *\n * Application data is initial data passed down to application from\n * Django generated page.\n */\nexport interface IAppData extends Record<string, any> {\n    /** User's data. */\n    user?: Record<string, any>\n}\n\n/**\n * This provide configuration to {@link AppContext}.\n */\nexport interface IApp {\n    /**\n     * Root API url\n     */\n    apiUrl?: string\n    /**\n     * Id of `<script>` element containing initial application data.\n     */\n    dataEl?: string\n    /**\n     * Models used by application.\n     */\n    models?: ModelType[]\n    /**\n     * Extra application data.\n     */\n    data?: IAppData\n}\n\n\n/**\n * This class provides context for Oxylus application.\n *\n * Which is:\n * - initial data: this is loaded from `<script>` HTML object.\n * - models: it will create adequate `pinia-orm/axios` repositories for them.\n *\n * The context is provided to Vue components in order to allow them\n * to access global information, such as current user or Panel.\n */\nexport class AppContext {\n    /** Reactive version of AppContext */\n    static reactive(opts: IApp) : IRAppContext {\n        // TODO: move to composables\n        const obj = reactive(new this(opts)) as IRAppContext\n        obj.user = computed(() => new User(obj.data?.user || {}))\n        return obj\n    }\n\n    constructor(opts: IApp = {}) {\n        Object.assign(this, opts)\n        this.state = State.none()\n        this.showState = false\n    }\n\n    /**\n     * Load data into AppData. If no `value` is provided, read it from\n     * source element.\n     */\n    load(value: any = undefined) {\n        if(this.dataEl !== undefined) {\n            if(value === undefined)\n                value = this.readData(this.dataEl)\n            value.dataEl = this.dataEl\n            this.data = value\n        }\n\n        if(this.models !== undefined) {\n            this.repos = useModels(this.models)\n        }\n    }\n\n    /**\n     * Read data from the context of provided source element.\n     * @param {String} dataEl - id of the DOM element.\n     * @return {Object} read data\n     */\n    readData(dataEl: string): any {\n        const el = document.getElementById(dataEl)\n        if(!el)\n            throw `Element {elementId} not found`;\n        return el.innerText ? JSON.parse(el.innerText) : {};\n    }\n}\nexport interface AppContext extends IApp {\n    /** Models' repositories */\n    repos?: Repos\n    /**\n     * Application level state. This can be displayed to user using\n     * {@link AppContext.showState}.\n     *\n     * This element can display errors to users.\n     */\n    state: State\n    /**\n     * Show application state to user.\n     */\n    showState: boolean\n}\nexport interface IRAppContext extends Reactive<AppContext> {\n    user: ComputedRef<User>\n}\n\n\n/**\n * Create a new {@link AppContext} and provide the following values:\n * - `context`: {@link AppContext} object;\n * - `user`: current {@link models.User};\n */\nexport function useAppContext(opts: IApp, load: boolean = true): AppContext {\n    const obj = AppContext.reactive(opts)\n    load && obj.dataEl && obj.load()\n\n    provide('context', obj)\n    provide('user', obj.user)\n    // provide('repos')\n    return obj\n}\n","import { computed, ref } from 'vue'\n\nimport type { Ref } from 'vue'\n\nimport { User, Model, type IPermissionGetCodename } from '../models'\n\n\n/**\n * A function to call when an action has been called.\n *\n * @param {User} user - user running the action.\n * @param {Model|null} item - item on which the action is run.\n * @param {any[]} ...args - extra arguments passed to the action.\n */\nexport type ActionRun<M extends Model, R> = (user: User, item: M, ...args: any[]) => Promise<R>\n\n\n/**\n * Callback when an action has been completed.\n *\n * @param {User} user - user running the action.\n * @param {Model|null} item - item on which the action was run.\n * @param {any} result - result of the action (return value of the called function).\n */\nexport type ActionCompleted<M extends Model, R> = (user: User, item: M, result: R) => void\n\n\n/**\n * Properties of an action.\n */\nexport interface IActionProps<M extends Model, R>\n{\n    /**\n     * Value or model instance.\n     */\n    item: M\n    /**\n     * Label text displayed to user.\n     */\n    title: string\n    /**\n     * Displayed icon\n     */\n    icon: string\n    /**\n     * Displayed color\n     */\n    color?: string\n    /**\n     * Display action as a small button\n     */\n    button?: boolean\n    /**\n     * If provided, ask user for a confirmation before executing the action.\n     */\n    confirm?: string\n    /**\n     * Required permission to run the action\n     */\n    permission: IPermissionGetCodename\n    /**\n     * The function to call when action is executed\n     */\n    run: ActionRun<M,R>\n\n    /** If provided, open this link */\n    href?: string\n}\n\n\n/** Interface of an action */\nexport interface IAction<M extends Model, R> {\n    /**\n     * Wether the action is running.\n     */\n    processing: Ref<boolean>\n    /**\n     * Action properties\n     */\n    props: IActionProps<M, R>\n}\n\n/**\n * Action's parameters, `user` MUST be provided.\n */\nexport interface IAction<M extends Model, R> {\n    /** Action components properties */\n    props: IActionProps<M, R>\n    /** The user running the action. */\n    user: User\n    /** If provided, emits `completed` once the action has been executed. */\n    emits?: (event: string, ...opts: any[]) => void\n}\n\n\n/**\n * Create a new action, returning:\n * - processing: ref to boolean indicating wether the action is processing\n * - allowed: computed ref indicating wether the action is allowed\n * - run: async function to call in order to run the method\n */\nexport function useAction<M extends Model,R>({props, user, emits=null}: IAction<M,R>) {\n    const processing = ref(false)\n    const allowed = computed(() => !props.permission || user.can(props.permission, props.item))\n\n    /** Execute the action. */\n    const run = async (...args: any[]): Promise<R|void> => {\n        if(props.confirm && !confirm(props.confirm))\n            return\n\n        if(props.href) {\n            window.open(props.href, '_blank')\n            return\n        }\n\n        processing.value = true\n\n        let result : R|Promise<R> = props.run(user, props.item, ...args)\n        if(result instanceof Promise)\n            result = await result\n\n        processing.value = false\n        if(emits)\n            emits('completed', props.item, ...args)\n        return result\n    }\n    return {processing, run, allowed}\n}\n","import { createApp as $createApp, reactive, watch } from 'vue'\nimport { createVuetify as $createVuetify } from 'vuetify'\nimport { md3 } from 'vuetify/blueprints'\nimport colors from 'vuetify/util/colors'\n\nimport { createPinia as $createPinia, setActivePinia } from 'pinia'\nimport { createORM } from 'pinia-orm'\nimport { createPiniaOrmAxios } from '@pinia-orm/axios'\nimport axios from 'axios'\n\nimport '../styles/index.scss'\nimport * as vendorComponents from '@oxylus/ox/vendor'\nimport config from '../config'\nimport {i18n, useI18n} from './i18n'\n\n\n\n/**\n * {@link createVuetify} parameters. Theses are passed down to Vuetify's\n * plugin initialization.\n */\nexport interface ICreateVuetifyOpts extends Record<string, any> {\n    components?: Record<string,any>\n}\n\n\n/**\n * Options passed to {@link createApp}.\n */\nexport interface ICreateAppOpts {\n    /**\n     * Vue's `createApp` `props` arguments\n     */\n    props?: Record<string, any>\n    /**\n     *  Vuetify plugin's parameters (passed to {@link createVuetify})\n     */\n    vuetify?: ICreateVuetifyOpts\n    /**\n     * Plugins to add to Vue application.\n     */\n    plugins?: Record<string, any>[]\n}\n\nexport interface IInitOpts extends ICreateAppOpts {\n    /** Vue's App config. */\n    App?: any\n    /** Element selector to mount application on. */\n    el?: string\n    /**\n     * If True (default), defer application creation after page has been\n     * loaded (on `window.load` event)\n     */\n    onLoad?: boolean\n}\n\n\n/**\n * Main entry point to initialize and mount an application.\n *\n * The base `App` config is provided by `ox/components` modules.\n */\nexport function init({App=null, el='#app', onLoad=true, ...options}: IInitOpts={}) {\n    function initApp() {\n        const app = createApp(App, options)\n        const vm = el ? app.mount(el) : null\n        document.body.classList.remove('loading')\n        return {app, el, vm}\n    }\n\n    return new Promise((resolve) => {\n        if(onLoad)\n            return window.addEventListener(\n                'load', () => resolve(initApp())\n            )\n        resolve(initApp())\n    })\n}\n\n\n/**\n * Create Oxerp application (including Vuetify).\n * It also provide app's global property `window` in order to allow components\n * access to this object.\n */\nexport function createApp(app: Record<string, any>, {props={}, vuetify={}, plugins=null}: ICreateAppOpts={}) {\n    app = $createApp(app, props)\n    app.config.globalProperties.window = window\n\n    app.use(createVuetify(vuetify))\n    app.use(i18n)\n    useI18n()\n\n    plugins && plugins.forEach(plugin => app.use(plugin))\n    return app\n}\n\n\n\n/**\n * Create and return vuetify plugin with default components set.\n * This is called by `createApp`.\n */\nexport function createVuetify({components={}, defaults={}, ...opts}: ICreateVuetifyOpts) {\n    opts.components = {\n        ...vendorComponents,\n        ...components\n    }\n    return $createVuetify({\n        blueprint: md3,\n        theme: {\n            themes: {\n                light: {\n                    dark: false,\n                    colors: {\n                        primary: colors.green.darken1,\n                        secondary: colors.green.lighten4\n                    }\n                }\n            }\n        },\n        defaults: {\n            ...defaults,\n            VTextField: { variant: 'underlined', },\n            VSelect: { variant: 'underlined', },\n            VTextarea: { variant: 'outlined', },\n            VCombobox: { variant: 'underlined', },\n            VAutocomplete: { variant: 'underlined', },\n        },\n        ...opts\n    })\n}\n\n\n\n/**\n * Create Pinia and PiniaOrm plugins instances.\n * If no `baseURL` is provided, get it from `document.body.dataset.apiUrl`.\n */\nexport function createPinia({axiosConfig=null, baseURL=null}: Record<string, any>={}) {\n    if(!baseURL)\n        baseURL = document.body.dataset.apiUrl\n\n    const pinia = $createPinia()\n    const piniaOrm = createORM({\n        plugins: [\n            createPiniaOrmAxios({\n                axios,\n                ...(axiosConfig || config.axiosConfig),\n                baseURL,\n            })\n        ]\n    })\n    setActivePinia(pinia)\n    return pinia.use(piniaOrm)\n}\n","import {Relation} from 'pinia-orm'\nimport type {Response} from '@pinia-orm/axios'\n\nimport {collectAttr} from '../utils'\nimport {asRelation, getSourceKey} from '../models'\nimport type {Repos, ModelId, Model, ModelType, Repository} from '../models'\n\n\n/** Interface of {@link Query} class. */\n/*export interface IQuery<MT extends ModelType> {\n}*/\n\n\n/** {@link Query.fetch} parameters. */\nexport interface IQueryFetch<MT extends ModelType> extends Partial<object> {\n    /**\n     * Fetch from this url.\n     * Usage of this argument is exclusive from {@link IQueryFetch.id} and {@link IQueryFetch.path}.\n     */\n    url?: string\n    /** Fetch item of this id, or items for those ids */\n    id?: ModelId | ModelId[],\n    /** Extra path to append on url. */\n    path?: string,\n    /** Model repository (instead of `Query.repo`'s one). */\n    repo?: Repository<MT>\n    /** Lookup field for ids (default: `id__in`). */\n    lookup?: string\n    /** Extra GET parameters. */\n    params?: Record<string, any>\n    /** Fetch items from thoses relations. */\n    relations?: string[]\n    /** If true (default value), save items in Pinia repository */\n    save?: boolean\n    /** Get data under this response's data key **/\n    dataKey?: string\n}\n\n\n/**\n * {@link Query.all} parameters.\n */\nexport interface IQueryAll<MT extends ModelType> extends IQueryFetch<MT> {\n    /**\n     * Key of object returned by server that provide url to next items.\n     */\n    nextKey?: string\n    /**\n     * Provide a limit to the number of request to do consecutivelly.\n     * If `-1`, no limit (**use with caution!**).\n     */\n    limit?: number\n}\n\n\n/**\n * This class allows to fetch objects from api, and their relations.\n *\n * It is a utility class built around ``pinia-orm/axios``, using\n * repositories' ``api().get`` method.\n *\n * It allows:\n *\n * - to fetch a model list or all values (using `next` key);\n * - to fetch relations of objects based on fields names;\n *\n * When fetching relations, please ensure that {@link Query.repos} is provided.\n *\n * @example\n * const query = new Query(repos.users, repos)\n *\n * // this fetch User model objects from API, then the related groups.\n * const result = await query.fetch({url: '/users', relations: ['groups']})\n */\nexport default class Query<MT extends ModelType> {\n    /**\n    * @param {Repos} [repos] all models repositories\n    * @param {Repository<M>} [repo] the main repository\n    */\n    constructor(repo: Repository<MT>, repos: Repos|null=null, opts: IQueryFetch<MT>={}) {\n        this.repo = repo\n        this.repos = repos\n        this.opts = opts\n    }\n\n    /** Fetch items from api. */\n    async fetch(options: IQueryFetch<MT> = {}) : Promise<Response> {\n        options = {...this.opts, ...options}\n        let {url, id, repo, lookup, params, relations, path, ...opts} = options\n\n        lookup ??= \"id__in\"\n        repo ??= this.repo\n\n        let ids = null\n        if(Array.isArray(id)) {\n            if(id.length == 1)\n                id = id[0]\n            else {\n                ids = id; id = null\n            }\n        }\n\n        if(!url) {\n            const _id = id as ModelId\n            url = repo.use?.meta?.getUrl({path, id: _id})\n        }\n\n        if(!id) {\n            if(!(\"dataKey\" in opts))\n                opts.dataKey = repo.use?.config?.axiosApi?.dataKey\n        }\n        else\n            opts.dataKey = null\n\n        // TODO: multiple request for the different ids\n        if(ids && lookup !== undefined) {\n            if(id)\n                throw Error(\"Both `ids` and `id` are provided while only one of those arguments is accepted.\")\n            params = {...(params || {})}\n            params[lookup] = ids.join(',')\n        }\n        const response = await repo.api().get(url, {...opts, params})\n        if(opts.save === false)\n            response.entities = this.getEntities(response)\n\n        if(relations)\n            response.relations = await this.relations(response.entities, relations, {...opts, params: {}})\n        return response\n    }\n\n    /** Get entities from response **/\n    getEntities(response: Response) {\n        const data = response.getDataFromResponse()\n        if(Array.isArray(data))\n            return data.map((dat) => this.repo.make(dat))\n        else\n            return [this.repo.make(data)]\n    }\n\n    /**\n     * Fetch all items from api.\n     *\n     * @param [options.nextKey] response object key to get next url\n     * @param [options.limit] max count of consecutive requests\n     * @return Response of the first request, whoses ``entities`` has \\\n     * model instances of all requests.\n     */\n    async all({nextKey='next', limit=-1, ...opts} : IQueryAll<MT> ={}) : Promise<Response> {\n        // FIXME: removed `flush`\n        const result = await this.fetch({...opts})\n\n        let url = result.response.data[nextKey]\n        while(url) {\n            const result2 = await this.fetch({...opts, url})\n            if(result2.entities)\n                result.entities = result.entities !== null ? result.entities.concat(result2.entities) : result2.entities\n            url = result2.response.data[nextKey]\n            if(limit>0) limit--\n            if(!limit) break\n        }\n        return result\n    }\n\n    /**\n     * Fetch all from API if repository is empty (see {@link Query.all}).\n     *\n     * For arguments see {@link Query.all}.\n     *\n     * Return null if no request has been made.\n     */\n    async allOnce(options: IQueryAll<MT> = {}) : Promise<Response|null> {\n        const repo = options.repo ?? this.repo\n        if(!repo.first())\n            return await this.all(options)\n        return null\n    }\n\n    /**\n     * Fetch related objects for the provided list and field names.\n     *\n     * @param objs - the objects to get related ids from.\n     * @param options.fields - list of field names.\n     * @param options.opts - options to pass down to {@link Quey.relation}.\n     * @return the resulting entities.\n     */\n    async relations(objs: InstanceType<MT>[], fields: string[], opts: IQueryAll<MT> = {}) : Promise<{[s: string]: Response}>\n    {\n        this._ensureRepos(\"relations\")\n        const entities: {[s: string]: Response} = {}\n        const relations = this.repo.use?.fields()\n        if(relations)\n            for(const field of fields) {\n                const relation = relations[field]\n                if(relation instanceof Relation)\n                    entities[field] = await this.relation(objs, relation, opts)\n                else\n                    throw Error(`Field ${field} is not a relation`)\n            }\n        return entities\n    }\n\n    protected _ensureRepos(funcName: string) {\n        if(!this.repos)\n            throw Error(`Query.repos is not provided although it is mandatory to call ${funcName}.`)\n    }\n\n    /**\n     * Fetch related objects for the provided object list and field name.\n     * It uses {@link Query.all} in order to fetch all items.\n     *\n     * @param objs - the objects to get ids from.\n     * @param relation - objects' field or field name.\n     * @param options - options to pass down to `all()`.\n     */\n    async relation(objs: Array<InstanceType<MT>>, relation: string | Relation, options: IQueryAll<MT> ={}) : Promise<Response> {\n        this._ensureRepos(\"relations\")\n\n        const rel = asRelation(this.repo, relation)\n        if(!rel)\n            throw Error(`No Relation found for field ${relation}.`)\n\n        const key = (<typeof Model>rel.related.constructor).entity\n        const repo2 = this.repos[key]\n        if(!repo2)\n            throw Error(`No repository \"${key}\" found.`)\n\n        const fk = getSourceKey(rel) as string\n        if(!fk)\n            throw Error(`No source ids attributes for ${relation}.`)\n        const id = [... new Set(collectAttr(objs, fk))]\n        const query = new Query(repo2, this.repos, {save: this.opts.save})\n        return query.all({...options, id, repo: repo2})\n    }\n\n}\nexport default interface Query<MT extends ModelType> {\n    /** Model repository used to store results. */\n    repo: Repository<MT>\n    /**\n     * Repositories used to store relations.\n     *\n     * This argument may be ignored if there is no need to fetch\n     * relations.\n     */\n    repos: Repos\n    /** Default options to set to all {@link Query.fetch} calls */\n    opts: IQueryFetch<MT>\n}\n\n\n/** Return a new {@link Query} based on repo's entity. */\nexport function query<MT extends ModelType>(repo: string|Repository<MT>, repos?: Repos, opts: IQueryFetch<MT>|null=null): Query<MT> {\n    if(typeof repo == \"string\") {\n        if(!(repo in repos))\n            throw Error(`Repository \"${repo}\" is not present in provided repositories.`)\n        return new Query(repos[repo] as unknown as Repository<MT>, repos, opts)\n    }\n    return new Query(repo, repos, opts)\n}\n","import { cloneDeep, isEqual, pick } from 'lodash'\nimport type { Attribute, Repository } from 'pinia-orm'\nimport type { Response } from '@pinia-orm/axios'\n\nimport Config from '../config'\nimport { assignNonEmpty, reset, State } from '../utils'\n\n\nexport interface IEditorProps<T extends Record<string, any>> {\n    /** Initial value provided to the editor */\n    initial: T\n    /** Editor name */\n    name?: string\n    /** Url to send value to */\n    url?: string\n    /** Callback to run after object has been saved */\n    saved?: (item: T, editor: IEditor<T,IEditorProps<T>>) => void\n}\n\n\n/**\n * Editor class interface.\n */\nexport interface IEditor<T extends Record<string, any>,P extends IEditorProps<T>> extends IEditorProps<T> {\n    [index: string]: any\n\n    props: P\n    /** Current edited value */\n    value: T\n    /** Empty value, if not provided generated */\n    empty?: T\n    /** Current editor state. Set to `State.PROCESSING` when saving instance. */\n    state: State\n}\n\n\n/**\n * An Editor handles data edition without changing original value.\n * It provides utilities in order to:\n * - detect if changes have been made;\n * - reset edited values to initial state;\n * - save data to server;\n *\n * Default implementation handles raw Object edition, but not saving data to the server.\n * Note: this might lead to errors due to reactivity when returned from composable.\n */\nexport default class Editor<T extends Record<string, any>, P extends IEditorProps<T>> {\n    state = State.none()\n    value: T = {} as T\n\n    constructor(options: IEditor<T,P>)\n    {\n        options && assignNonEmpty(this, options)\n        if(!this.state)\n            this.state = new State()\n\n        this.value ??= {} as T\n        this.empty ??= {} as T\n        this.initial ??= this.props.initial || this.empty\n        this.valid = true\n        this.reset(this.initial)\n    }\n\n    get name(): string { return this.props.name }\n    get url(): string|null { return this.props.url }\n\n    get errors() : any {\n        return this.state.isError && this.state.data || null\n    }\n\n    error(field: string): string|string[] {\n        const data = this.state.isError && this.state.data?.[field]\n        if(data)\n            return this.state.data.__value?.[field] == this.value[field] && data.join('\\n') || ''\n        return ''\n    }\n\n    /** Discard changes, resetting to initial value. */\n    discard() {\n        this.reset(this.initial)\n    }\n\n    /**\n     * Reset editor data to provided value.\n     * When value is provided, reset initial to this value.\n     */\n    reset(value: T = null) {\n        reset(this.value, value ?? this.empty)\n        this.state.none()\n    }\n\n    /** Return wether value has been edited or not */\n    isEdited(): boolean {\n        return !isEqual(this.value, this.initial)\n    }\n\n    /**\n     * Save data. It will `serialize()` value then `send()` it.\n     *\n     * Note: default implementation does not provide `send()` method\n     * and thus will raise an error.\n     *\n     * @param [value] if provided use this instead of `this.value`. When a form is provided, it will get\n     * @return state.\n     */\n    async save(value: T|FormData|null = null, params:Record<string, any>={}): Promise<State> {\n        this.state.processing()\n\n        if(this.valid === false)\n            return this.state.error({\n                \"_\": \"Some of the input values are invalid\"\n            })\n\n        value ??= this.value\n        if(value instanceof FormData)\n            params.headers = {\n                ...Config.axiosConfig.headers,\n                'Content-Type': 'multipart/form-data',\n                ...params.headers,\n            }\n        else\n            value = this.serialize(value)\n\n        const state = await this.send(value, params)\n        if(state.isOk) {\n            this.reset(state.data as T)\n            this.initial = cloneDeep(this.value)\n            this.saved?.(this.value)\n        }\n        else {\n            this.state = state\n            // keep sent value here (will be reset on next try)\n            // this allows to handle error display correctly\n            this.state.data = { ...this.state.data, __value: value }\n        }\n        return this.state\n    }\n\n    /**\n     * This method is called when editor successfully saved the\n     * edited item to the server.\n     *\n     * By default, it will call {@link Editor.props.saved} if provided.\n     */\n    saved(item: T) {\n        this.props.saved?.(item, this)\n    }\n\n    /** Serialize value before sending. */\n    serialize<R>(value: T): any { return value }\n\n    /** Send value (not implemented, MUST BE in subclasses). */\n    async send(_: Record<string, any>|FormData, params: Record<string, any>): Promise<State> {\n        throw \"not implemented\"\n    }\n}\nexport default interface Editor<T,P extends IEditorProps<T>> extends IEditor<T,P> {\n    // Whether edited data are valid. Default to `true`.\n    valid: boolean\n}\n","import {computed, watch} from 'vue'\nimport type {WatchHandle, Reactive} from 'vue'\n\nimport {t} from '../composables'\nimport {assignNonEmpty, State} from '../utils'\nimport type Panels from './panels'\n\n\nexport interface IPanelInfo {\n    /** Panel's name */\n    name: string\n    /** The view title displayed to user. */\n    title?: string\n    /** The view's icon displayed to user. */\n    icon?: string\n}\n\n\n/** Properties of OxPanel **/\nexport interface IPanelProps extends IPanelInfo {\n    /** Index view name **/\n    index: string\n    /** Panel's view */\n    view: string\n    /** Current value */\n    value?: any\n    /** Optional state (used with `ox-state-alert`). */\n    state?: State\n    /** Url to related help page */\n    help?: string\n}\n\n\n/** Display/GET parameters for displaying a view. */\nexport interface IPanelParams<V=any> extends Record<string, any> {\n    view?: string\n    value?: V\n}\n\n\n/** Options passed to {@link Panel.show} */\nexport interface IPanelShow<V=any> {\n    /** Name of the view to display. */\n    view?: string\n    /** Value to provide to the view. */\n    value?: V\n    /** Do not update current location using history API. */\n    silent?: boolean\n    /**\n     * Force displaying the view, eg. don't ask for user confirmation\n     * when something has been edited.\n     */\n    force?: boolean\n}\n\n\nexport interface IPanel<P> extends IPanelInfo {\n    /** Panel component properties. */\n    props: P\n    /**\n    * The {@link Panels} controller used to specify current view and value.\n    *\n    * This element may be shared among multiple Panel instances.\n    */\n    panels: Panels\n    /**\n     * Current unsaved changes. This can be updated by component in order\n     * to prevent data loss when changing panels.\n     */\n    editions: Set<string>\n}\n\n\n/**\n * This is the base class used by panels.\n *\n * Template parameters:\n *\n * - `P`: type of panel properties ({@link IPanelProps});\n * - `V`: type for value;\n *\n */\nexport default class Panel<V=any, P extends IPanelProps = IPanelProps>\n{\n    index: string = 'list.table'\n    view: string = ''\n    value: any = null\n    item: any = null\n    editions: Set<string> = new Set()\n\n    /**\n     * Translation key for message displayed on `confirm()` to leave unsaved\n     * changes.\n     */\n    confirmTKey = \"panel.confirm\"\n\n    /** Panel name (based on props) **/\n    get name(): string { return this.props?.name || '' }\n\n    /** Wether there are still edited items on current view. */\n    get edited(): boolean { return !!this.editions?.size }\n\n    /** Return adequate icon based on props and model **/\n    get icon(): string { return this.props?.icon || null }\n\n    /** Return panel's title based on props. */\n    get title(): string { return this.props?.title }\n\n    constructor(options: IPanel<P>|null = null) {\n        options && assignNonEmpty(this, options)\n        this.view ??= this.index || ''\n    }\n\n    /** Return URL GET parameters for the current view. */\n    getUrlParams(): IPanelParams {\n        const params : IPanelParams = {panel: this.name}\n        if(this.view != this.index)\n            params.view = this.view\n        if(this.view.startsWith('detail.') && this.value)\n            params.value = this.value\n        return params\n    }\n\n\n    /** Set or remove an edition by name. */\n    setEdition(name: string, edited: boolean) {\n        if(edited) this.editions.add(name)\n        else this.editions.delete(name)\n    }\n\n    /**\n     * Show a view, providing optional value.\n     * @return - true if view changed\n     */\n    show({view=null, value=null, silent=false, force=false}: IPanelShow<V>={}): boolean {\n        if((view != this.view || value != this.value) && (force || this.canLeave())) {\n            this.view = view || this.index\n            this.value = value\n            !silent && this.updateLocation()\n            return true\n        }\n        return false\n    }\n\n    /** Update current location using History api (push state). */\n    updateLocation() {\n        const params = this.getUrlParams()\n        if(params) {\n            const url = (new URLSearchParams(params)).toString()\n            history.pushState(params, \"\", `?${url}`)\n        }\n    }\n\n    /**\n     * Called when view or panel changes. It returns `true` if view/panel can be changed.\n     *\n     * Ask user for confirmation if there is unsaved changes (aka editions).\n     *\n     * @return true if we can proceed to view/panel change.\n     */\n    canLeave(): boolean {\n        if(!this.edited)\n            return true\n\n        const msg = t(this.confirmTKey)\n        return confirm(msg)\n    }\n}\nexport default interface Panel<V=any, P extends IPanelProps=IPanelProps> extends IPanel<P> {}\n","import {provide} from 'vue'\nimport {assignNonEmpty} from '../utils'\nimport type {default as Panel, IPanelShow, IPanelParams} from './panel'\n\n\nexport interface IPanels {\n    /** Current panel's name. **/\n    panel: string\n    /** Current panel's view name **/\n    view?: string\n    /** Display/GET parameters for the current panel. */\n    params?: IPanelParams\n}\n\n/** Options passed to {@link Panels.show} */\nexport interface IPanelsShow extends IPanelShow {\n    /** Panel's name to display */\n    panel: string\n    /**\n     * Optional url name. This allows to provide actual app location to\n     * go to if the current page is not the specified one.\n     */\n    href?: string\n}\n\n/**\n * This class is used to panels a panel, providing extra information such\n * as value and view. It is shared among panels.\n *\n * Use it as this provides utilities to avoid data loss and allow current\n * panel to have control over leaving it.\n */\nexport default class Panels {\n    panel: string = \"\"\n    params: Record<string, any> = {}\n    paramsString: string = ''\n    children: {[k: string]: Panel} = {}\n    current: Panel|null\n\n    constructor(options: IPanels|null = null) {\n        options && assignNonEmpty(this, options)\n    }\n\n    /**\n     * Set {@link Panels.params based on current document location.\n     */\n    readDocumentLocation() {\n        this.paramsString = document.location.search.substring(1)\n        const search = new URLSearchParams(this.paramsString)\n        const {panel, ...params} = Object.fromEntries(search.entries())\n        this.panel = panel\n        this.params = params || {}\n    }\n\n    /** Read provided path and return current panel and view */\n    static readPath(path: string) : IPanels {\n        if(!path)\n            return {panel: \"\", view: \"\"}\n\n        const idx = path.indexOf('.')\n        if(idx < 0)\n            return {panel: path, view: ''}\n        return {panel: path.substring(0, idx), view: path.substring(idx+1)}\n    }\n\n    /** Register a panel */\n    register(name: string, child: Panel) {\n        if(!this.children[name]) {\n            this.children[name] = child\n\n            // Set current to child if required\n            if(this.panel == child.name) {\n                this.current = child\n                child.show(this.params)\n            }\n        }\n    }\n\n    /** Unregister a panel */\n    unregister(name: string) {\n        delete this.children[name]\n    }\n\n    /**\n     * Show a panel, loading page provided by href if required.\n     * When there is already a panel displayed, it will call {@link Panel.onLeave} in order to eventually prevent\n     * unwanted page change.\n     */\n    show({force=false, href=null, ...options}: IPanelsShow) {\n        const proceed = force || this.canLeave()\n        if(!proceed)\n            return\n\n        if(href && window.location.pathname != href) {\n            if(!options.panel)\n                throw Error(\"The attribute `href` requires`panel`.\")\n\n            href = `${href}?panel=${options.panel}`\n            if(options.view)\n                href = `${href}&view=${options.view || ''}`\n            window.location.href = href\n            return\n        }\n\n        this.reset(options)\n    }\n\n    /** Return whether we can change page/panel. */\n    canLeave(): boolean {\n        return this.current ? this.current.canLeave() : true\n    }\n\n    reset({panel, silent=false, ...params}: IPanelsShow) {\n        const panelChanged = (panel && panel != this.panel)\n        if(panelChanged && !this.canLeave())\n            return\n\n        this.panel = panel || this.panel\n        this.params = params\n\n        // Set current and if yet registered, show it.\n        this.current = this.children[this.panel]\n        this.current?.show({...this.params, silent})\n    }\n}\nexport default interface Panels extends IPanels {\n    /** Current panel (set by panels) **/\n    current: Panel|null\n}\n","import type {Query as $Query} from 'pinia-orm'\nimport type {Response} from '@pinia-orm/axios'\n\nimport {State, assignNonEmpty} from '../utils'\nimport type {ModelType, ModelId, Repository} from '../models'\n\nimport Query from './query'\nimport type {IQueryFetch} from './query'\n\n\nexport interface IModelController<MT extends ModelType> {\n    /** Response's key used to return data */\n    dataKey?: string\n    /** {@link Query} used to fetch list items. */\n    query: Query<MT>\n    /** Related fields to get from pinia orm's database and eventually fetch when items are retrieved from API.  */\n    relations?: string[]\n    /** Use this URL instead of model's defined one. */\n    url?: string\n    /** Fetch related fields from API when queried */\n    fetchRelations: boolean\n    /** If true (default value), save items in Pinia repository */\n    save?: boolean\n}\n\nexport interface IModelFetch<MT extends ModelType> extends IQueryFetch<MT> {\n    /** Response's key used to return data */\n    dataKey?: string\n    /** If true, force loading all items */\n    all: boolean\n}\n\n\n/**\n * Base controller class that handles model fetching from the server in conjunction\n * with ORM framework.\n *\n * This provides:\n * - load items from the server and manage state accordingly (using {@link Query});\n * - items are retrieved from ORM store with specified relations;\n *\n * It does not:\n * - fetch items' related objects.\n *\n * This is used for {@link ModelDetail} and {@link ModelList}.\n */\nexport default class ModelController<MT extends ModelType, O=IModelController<MT>> {\n    state = State.none()\n    save?: boolean = true\n\n    /** The repository of contained items. */\n    get repo(): Repository<MT> { return this.query.repo }\n\n    /** Current model. */\n    get model(): MT { return (this.repo.use as MT) }\n\n    constructor(options: IModelController<MT>|null = null) {\n        options && assignNonEmpty(this, options)\n    }\n\n    /** Return orm's query to object. This will includes declared {@link List.relations}.\n     *\n     *   @param ids - optional id lookup\n     *   @return orm's query\n     */\n    queryset(ids: ModelId|ModelId[]|null=null) : $Query<InstanceType<MT>> {\n        let query = this.repo.query()\n        if(this.relations)\n            for(const relation of this.relations)\n                query = query.with(relation)\n\n        if(ids !== null)\n            query = query.whereId(ids)\n        return query\n    }\n\n    /**\n     * Fetch model instance from the server and select them.\n     *\n     * Calling this method updates state to:\n     * - `PROCESSING`: request is being made;\n     * - `NONE`: request has been done without error;\n     * - `ERROR`: if an error happened;\n     *\n     * Flowchart:\n     * - {@link ModelController.fetch}\n     * - {@link ModelController.handleResponse}\n     */\n    async load(options: IModelFetch<MT> = {all: false}): Promise<Response|null> {\n        this.state.processing()\n        let response = null\n        try {\n            response = await this.fetch(options)\n            response = await this.handleResponse(options, response)\n        }\n        catch(error) {\n            console.log(error)\n            this.state.error(error)\n        }\n        if(!this.state.isError)\n            this.state.none()\n        return response\n    }\n\n    /** Fetch model instance from the server.\n     *\n     * Flowchart:\n     * - {@link ModelController.getQueryParams}\n     * - {@link Query.fetch}\n     */\n    async fetch(options: IModelFetch<MT> = {all: false}) : Promise<Response> {\n        const opts = this.getQueryOptions(options)\n        const func = options.all ? this.query.fetch : this.query.all\n        return await this.query.fetch(opts)\n    }\n\n    /** Handle response from the {@link ModelContainer.fetch}'s request. */\n    async handleResponse(options: IModelFetch<MT>, response: Response): Promise<Response> {\n        // TODO: handle status code\n        return response\n    }\n\n    /** Get {@link Query.fetch} options. */\n    protected getQueryOptions(options: IModelFetch<MT>): IQueryFetch<MT> {\n        if(!options.relations && this.relations && this.fetchRelations)\n            options.relations = this.relations\n        // if(!(\"dataKey\" in options))\n        //    options.dataKey = this.dataKey\n        if(!options.url)\n            options.url = this.url\n        if(!(\"save\" in options))\n            options.save = this.save\n        return options\n    }\n}\nexport default interface ModelController<MT extends ModelType, O> extends IModelController<MT> {\n    /** Current request's state. */\n    state: State\n}\n","import type {Response} from '@pinia-orm/axios'\nimport {union, map} from 'lodash'\n\nimport type {ModelType, ModelId} from '../models'\n\nimport type {IQueryFetch} from './query'\nimport type {IModelController, IModelFetch} from './modelController'\nimport ModelController from './modelController'\n\n\nexport type FilterValue = number | string\nexport type Filters = Record<string,FilterValue>\n\n\n/** Base interface of a ModelList */\nexport interface IModelList<MT extends ModelType> extends IModelController<MT> {\n    /** Provide extra GET parameters. */\n    filters?: Filters\n    /** Response's key used to return URL to previous paginated items. */\n    prevKey?: string\n    /** Response's key used to return URL to next paginated items.  */\n    nextKey?: string\n    /** Response's key used to return total items count. */\n    countKey?: string\n}\n\n/**\n * Arguments of {@link ModelList.fetch}. It is passed down to {@link Query.fetch}.\n */\nexport interface IModelListFetch<MT extends ModelType> extends IModelFetch<MT> {\n    /** Query's GET parameters used to filter the list. */\n    filters?: Filters\n    /**\n     * Append items to list. If `false` (default), fetch results will replace\n     * current list items.\n     */\n    append?: boolean | number\n}\n\n\n/**\n * Handle a list of model instances fetched using Rest Api. It is\n * used in model's panels.\n *\n * It uses {@link Query} object in order to fetch items and relations.\n *\n * Items references are tracked using repo's {@link RefCounter}.\n *\n * @example\n * const {list, items} = useModelList({\n *     query: new Query(repos.users, repos),\n *     relations: ['groups'],\n * })\n *\n * await list.load({url: '/users'})\n */\nexport default class ModelList<MT extends ModelType> extends ModelController<MT, IModelList<MT>> {\n    // /** Reference counter key **/\n    // $id: number\n\n    ids: ModelId[] = []\n    filters: Filters = {}\n    nextUrl: string|null = null\n    prevUrl: string|null = null\n    count: number|null = null\n    page_size: number|null = null\n\n    dataKey = \"results\"\n    nextKey = \"next\"\n    prevKey = \"previous\"\n    countKey = \"count\"\n\n    get length() { return this.ids.length }\n\n\n    /** Return index for id */\n    indexOf(id: number) { return this.ids.indexOf(id) }\n\n    /** Destroy list, ensuring cleaning behind the scenes */\n    drop() {\n        this.ids.splice(0)\n    }\n\n    /** Reset list */\n    reset(ids: ModelId[] = []) {\n        this.ids = [...ids]\n        this.nextUrl = null\n        this.prevUrl = null\n        this.count = this.ids.length\n    }\n\n    /** Get item index by id */\n    //findIndex(id: number): number { return this.items.findIndex((v) => v.id == id) }\n\n    /** Add item if not present in list.\n    *\n    * @param id - item id to insert\n    * @param index - if provided insert at this position\n    * @return item index if already in the list, else insertion one\n    */\n    add(id: ModelId, index: number = null): number {\n        const idx = this.ids.indexOf(id)\n        if(idx != -1)\n            return idx\n\n        if(index !== null) {\n            this.ids.splice(index, 0 , id)\n            return index\n        }\n        this.ids.push(id)\n        return this.ids.length-1\n    }\n\n    /** Remove item by id from list if present. */\n    remove(id: ModelId) {\n        const idx = this.ids.indexOf(id)\n        if(idx != -1)\n            this.ids.splice(idx, 1)\n    }\n\n    /**\n     * Get item id next to provided one at the specified direction.\n     *\n     * @param item - reference item\n     * @param step - increment or decrement item index by this value.\n     * @return the target item id or null if not found.\n     */\n    getSiblingIndex(item: InstanceType<MT>|null, step: number): number {\n        if(item === null)\n            return -1\n\n        const index = this.ids.indexOf(item.id)\n        const sibling = index >= 0 ? index+step : -1\n        return sibling >= 0 && sibling < this.ids.length ? sibling : -1\n    }\n\n    /**\n     * Fetch next items from API, override `url` using {@link ModelList.nextUrl}.\n     */\n    async loadNext(options: IModelListFetch<MT>): Promise<Response> {\n        return await this.load({...options, url: this.nextUrl})\n    }\n\n    /**\n     * Fetch previous items from API, override `url` using {@link ModelList.prevUrl}.\n     */\n    async loadPrev(options: IModelListFetch<MT>): Promise<Response> {\n        return await this.load({...options, url: this.prevUrl})\n    }\n\n    protected getQueryOptions(options: IModelFetch<MT>): IQueryFetch<MT> {\n        if(!(\"filters\" in options) && this.filters)\n            options.params = {...this.filters, ...(options.params ?? [])}\n        if(this.page_size)\n            options.params = {...options.params, page_size: this.page_size}\n        return super.getQueryOptions(options)\n    }\n\n    /**\n     * Handle response from API: update owned items list and related information (next/prev url, total count).\n     *\n     * Theses informations will not be set if `options.save == false`. You\n     * can however call this method later if you need to defer persistence.\n     */\n    async handleResponse({append=false, ...options}: IModelListFetch<MT>, response: Response): Promise<Response> {\n        response = await super.handleResponse(options, response)\n        if(!this.state.isError && options.save !== false) {\n            const ids = map(response.entities, 'id')\n            this.update(ids, append)\n            this.nextUrl = response.response.data[this.nextKey] || null\n            this.prevUrl = response.response.data[this.prevKey] || null\n            this.count = response.response.data[this.countKey] || this.ids.length\n        }\n        return response\n    }\n\n    /**\n     * Update the list with the provided ids\n     *\n     * @param {ModelId[]} ids - The ids to add to the list\n     * @param {boolean|number} append - When `true`, append items. When a number, insert at the provided position. \\\n     *                                  When `false`, remove all previous ids.\n     */\n    update(ids?: ModelId[], append: boolean|number =false) {\n        if(typeof append == \"number\")\n            this.ids.splice(append, 0, ...ids)\n        else if(append && this.ids.length)\n            this.ids = union(this.ids, ids)\n        else\n            this.ids = ids\n    }\n\n    /**\n     * Update the list with the provided items.\n     *\n     * It first insert items in the repository before calling {@link ModelList.update}.\n     *\n     * @param {Model[]} items - The items to insert and add to the list.\n     * @param ...args - Arguments passed down to {@link ModelList.update}.\n     */\n    updateWith(items: InstanceType<MT>[], append: boolean|number = false) {\n        this.repo.insert(items)\n        this.update(items.map(v => v.id), append)\n    }\n}\n\nexport default interface ModelList<MT extends ModelType> extends IModelList<MT> {\n    ids: ModelId[]\n    nextUrl: string|null\n    prevUrl: string|null\n    count: number|null\n}\n","import { cloneDeep, isEqual, pick } from 'lodash'\nimport type { Attribute, Repository } from 'pinia-orm'\nimport type { Response } from '@pinia-orm/axios'\nimport {toRaw} from 'vue'\n\nimport { State } from '../utils'\nimport Editor from './editor'\nimport type { Model } from '../models'\nimport type {IEditor, IEditorProps} from './editor'\n\n\n/**\n * ModelEditor properties (as passed down to {@link OxModelEdit} component).\n */\nexport interface IModelEditorProps<T extends Model> extends IEditorProps<T> {\n    /** Related repository */\n    repo: Repository<T>\n}\n\nexport interface IModelEditorSend extends Record<string, any> {\n    id: number\n}\n\n\n/**\n * Editor sub-class used to edit model instances.\n *\n * Regarding properties ({@link IModelEditorProps}):\n * - `name` defaults to `{model.entity}-edit`.\n * - `repo` is mandatory\n *\n */\nexport default class ModelEditor<T extends Model, P extends IModelEditorProps<T>> extends Editor<T,P> {\n    constructor(options : IEditor<T,P>) {\n        options.fields = Object.keys((options.props.repo.use as typeof Model).fields())\n        options.empty ??= new options.props.repo.use() as T\n        super(options)\n    }\n\n    get repo() { return this.props.repo }\n    get name() { return this.props.name || `${this.repo.use.entity}-edit` }\n    isEdited(): boolean {\n        return !isEqual(pick(this.value, this.fields), pick(this.initial, this.fields))\n    }\n\n    get url(): string {\n        const url = super.url || (this.repo.use as typeof Model)?.meta?.url\n        if(!url)\n            throw Error(\"No url specified as parameter or in Model.meta.\")\n        return url\n    }\n\n    reset(value: T = null): void {\n        if(!value || !Object.keys(value).length)\n            value = this.empty\n\n        const fields = this.fields.filter(k => k in value)\n        this.value = (cloneDeep(pick(value, fields)) || {}) as T\n        this.state.none()\n    }\n\n    serialize(value: T): {[k: string]: any} {\n        const cls = this.repo.use\n        const obj = new cls({...this.value})\n        return obj.$toJson(null, {relations: false})\n    }\n\n    async send(value: IModelEditorSend|FormData, params: Record<string, any> = {}) : Promise<State> {\n        let [func, url] = [\"post\", this.url]\n        if(this.value.id) {\n            url = `${url}${this.value.id}/`\n            func = \"put\"\n        }\n        return await this.repo.api()[func](url, value, params).then(\n            (result: Response) => State.ok(result.entities[0]),\n            (error: Response) => State.error(error.response.data)\n        )\n    }\n}\nexport default interface ModelEditor<T extends Model, P extends IModelEditorProps<T>> extends Editor<T,P> {\n    fields: string[]\n}\n","import {computed, reactive, toRefs} from 'vue'\nimport type {Reactive} from 'vue'\n\nimport {Model} from '../models'\nimport {mapToObject} from '../utils'\nimport {t, tKeys} from '../composables/i18n'\n\nimport type ModelList from './modelList'\nimport type Query from './query'\nimport type {ModelType, Repository, Repos} from '../models'\n\nimport type {default as IPanel, IPanelProps, IPanelParams, IPanelShow} from './panel'\nimport type Panels from './panels'\n\nimport Panel from './panel'\nimport {query} from './query'\n\n\n/** Model panel component properties. */\nexport interface IModelPanelProps<MT extends ModelType> extends IPanelProps {\n    /** Current repository */\n    repo: Repository<MT>\n    // search: string\n    /** Current view */\n    view: string\n    /** List table headers */\n    headers?: string[]\n    /** Related fields to get from pinia orm's database and eventually fetch when items are retrieved from API.  */\n    relations?: string[]\n    /** Show filters */\n    showFilters?: boolean\n    /** Fetch related fields from API when queried */\n    fetchRelations: boolean\n    /** Search filter lookup */\n    search: string\n\n    /**\n     * Display this warning on the top of the panel.\n     */\n    warning?: string\n}\n\n/** Display/GET parameters for displaying a view on {@link ModelPanel} */\nexport interface IModelPanelParams extends IPanelParams {\n    id?: number|string\n}\n\n/** Options for {@link ModelPanel.show} */\nexport interface IModelPanelShow<MT extends ModelType> extends IPanelShow<InstanceType<MT>> {\n    id?: number|string\n}\n\n/** Model panel interface. */\nexport interface IModelPanel<\n    MT extends ModelType,\n    P extends IModelPanelProps<MT> = IModelPanelProps<MT>\n> extends IPanel<InstanceType<MT>, P>\n{\n    /** List controller used to load and handle multiple items from the server. */\n    list: ModelList<MT>\n    /** Detail controller used to load and handle a single item from the server. */\n    //detail: ModelListDetail<M>\n}\n\n/** This class handles model panel (used by {@link OxModelPanel}. */\nexport default class ModelPanel<\n    MT extends ModelType,\n    P extends IModelPanelProps<MT> = IModelPanelProps<MT>,\n> extends Panel<InstanceType<MT>, P>\n{\n    showFilters: boolean = false\n\n    constructor(options: ModelPanel<MT,P>) {\n        super(options)\n        this.showFilters = this.props?.showFilters || false\n    }\n\n    /** Current model's repository. */\n    get repo(): Repository<MT> { return this.props.repo }\n\n    /** Current model. */\n    get model(): MT { return this.repo.use }\n\n    /** Query (shortcut to `this.list.query`). **/\n    get query(): Query<MT> { return this.list.query }\n\n    /** Return icon based on props and model **/\n    get icon(): string { return super.icon || this.model.meta?.icon }\n\n    /** Return panel's title based on view and current item. */\n    get title(): string {\n        const {props, list} = this\n        const model = this.repo.use as typeof Model\n        if(model) {\n            // many items\n            if(this.view?.startsWith('list.'))\n                return t(tKeys.model(model), 3)\n\n            if(this.view?.startsWith('detail.')) {\n                if(this.value?.$title)\n                    return this.value.$title\n\n                const name = t(tKeys.model(model))\n                return this.value?.id\n                    ? t(`models._.title`, {model: name, id: this.value.id})\n                    : t(`models._.title.new`, {model: name})\n            }\n        }\n        return super.title\n    }\n\n    getUrlParams(): IModelPanelParams {\n        const {value=null, ...params} = super.getUrlParams()\n        if(value?.id)\n            params.id = value.id\n        return params\n    }\n\n    /**\n     * Edit a new item.\n     *\n     * @param view - edit view.\n     */\n    create(view: string='detail.edit') {\n        this.show({view, value: null})\n    }\n\n    /** Called when an item has been created. By default, show edit view. */\n    created(value: InstanceType<MT>, view: string=\"detail.edit\") {\n        // this.list.load()\n        this.show({view, value})\n    }\n\n    show({id=null, ...params}: IModelPanelShow<MT>): boolean {\n        if(id) {\n            // FIXME: this.relations or this.props.relations\n            query(this.repo).fetch({id, relations: this.props.relations}).then(r => {\n                super.show({...params, value: r.entities[0] as InstanceType<MT>})\n                return r\n            })\n        }\n        else\n            return super.show(params)\n    }\n}\n\n\nexport default interface ModelPanel<MT extends ModelType, P extends IModelPanelProps<MT>=IModelPanelProps<MT>>\n    extends IModelPanel<MT,P>\n{\n    //detail: ModelListDetail<M>\n    showFilters: boolean\n}\n","import {\n    computed, inject, isRef, toRefs, unref, watch,\n    onMounted, onUnmounted, provide, reactive\n} from 'vue'\n\nimport type {ComputedRef, Reactive, Ref, WatchHandle, UnwrapRef} from 'vue'\n\nimport {State, ifNotEqualFn} from '../utils'\nimport type {Repos, Model, ModelType, Repository} from '../models'\n\nimport {\n    Panels, Panel, ModelPanel,\n    Query, ModelList,\n    Editor, ModelEditor\n} from '../controllers'\n\nimport type {\n    IPanels, IPanel, IPanelProps,\n    IModelPanel, IModelPanelProps,\n    IModelList,\n    IEditor, IEditorProps, IModelEditorProps,\n    IQueryFetch\n} from '../controllers'\n\n\n//---- Panels\n/**\n * Create a new reactive {@link Panels} and provide it as `panels`.\n *\n * It also creates watchers in order to:\n * - update document title based on current panel's view\n * - keep track of current view's url: when a panels' getUrlParams changes, it will `History.pushState` storing those params;\n *\n * @return the reactive Panels.\n */\nexport function usePanels(options: IPanels) {\n    const panels = reactive(new Panels(options))\n    provide('panels', panels)\n\n    onMounted(() => {\n        panels.readDocumentLocation()\n        panels.panel && panels.show({\n            panel: panels.panel, silent: true,\n            ...panels.params\n        })\n    })\n\n    window.addEventListener(\"popstate\", (event) => {\n        if(event.state)\n            panels.show({...event.state, silent: true})\n    })\n\n    // we update title after history state\n    const initialTitle = document.title\n    watch(() => panels.current?.title, (val) => {\n        if(val)\n            document.title = `${val} | ${initialTitle}`\n        else\n            document.title = initialTitle\n    })\n\n    return panels\n}\n\n/** Create a new {@link Panel}.\n*\n* - (un)register the panel to object's `panels` on (un)mount.\n* - provide `panel`;\n* - watch on {@link Panel.view} calling {@link Panel.onViewChange}\n*/\nexport function usePanel<V, P extends IPanelProps>(options: IPanel<P>, cls: typeof Panel<V,P>) {\n    const panel = reactive(new cls(options))\n\n    provide('panel', panel)\n    onMounted(() => panel.panels.register(panel.name, panel))\n    onUnmounted(() => panel.panels.unregister(panel.name))\n\n    // watch(() => panel.view, (val, old) => val != old && panel.onViewChange(val))\n    return {panel}\n}\n\n\nexport interface IUseModelPanel<MT extends ModelType, P extends IModelPanelProps<MT>> extends IModelPanel<MT,P> {\n    /** Provide this query for the {@link ModelList}. **/\n    query?: Query<MT>\n    /** Provide this repositories to create a {@link Query} used by {@link ModelList}. */\n    repos?: Repos\n}\n\n/**\n * Create a new {@link ModelPanel}.\n * Return `{panels, panel, list, items, next, prev}` (next and prev are items related to the current selected one by `panel.value`).\n */\n// TODO: allow to pass list down\nexport function useModelPanel<MT extends ModelType, P extends IModelPanelProps<MT>>(\n    {query, repos, ...options}: IUseModelPanel<MT,P>\n)\n{\n    repos ??= inject('repos')\n    query ??= new Query(options.props.repo, repos)\n    options.panels ??= inject('panels')\n\n    const {list, items} = useModelList({\n        query,\n        relations: options.props.relations,\n        fetchRelations: options.props.fetchRelations\n    })\n    const {panel} = usePanel({list, name: options.props.name, ...options}, ModelPanel<MT, P>)\n\n    const next = computed(() => {\n        const index = list.getSiblingIndex(unref(panel.value), 1)\n        return items.value[index] ?? null\n    })\n    const prev = computed(() => {\n        const index = list.getSiblingIndex(unref(panel.value), -1)\n        return items.value[index] ?? null\n    })\n\n    return {panels: panel.panels, panel, list, items, next, prev}\n}\n\n\n//---- Controllers\n/**\n * Create a new {@link ModelList} and provide it as `list`.\n *\n * A ModelList only stores the ids of the items, though loading will add them to the\n * repo. In order to keep memory usage low, we use an acquire-release mechanism which\n * will release items from repos that are no longer use by any list.\n *\n * The returned object will have:\n * - `list`: the ModelList instance;\n * - `items`: a computed values based on list's ids;\n * - `listId`: the list id used to track items acquisition and release;\n *\n */\nexport function useModelList<MT extends ModelType>(options : IModelList<MT>, cls: typeof ModelList = ModelList)\n{\n    const list = reactive(new cls(options))\n    const listId = list.repo.refs.acquireKey()\n\n    // FIXME:\n    // - we have items in order for them to be updated from repo\n    // - list stores items as items\n    // - we query items from db using list.ids (= maps of list.items)\n    // - this adds levels of indirections and extra layers\n    const items = computed(() => list.length ? list.queryset(list.ids).orderBy(id => list.ids.indexOf(id)).get() : [])\n\n    // release - acquire refs\n    watch(\n        () => list.ids,\n        ifNotEqualFn((val, old) => list.repo.refs.releaseAcquire(listId, old, val))\n    )\n    onUnmounted(() => list.repo.refs.flush(listId))\n\n    provide('list', list)\n    provide('items', items)\n    return {list, items, listId}\n}\n\n/**\n * This composable return a new {@link Query}, {@link State} and a fetch\n * function that combines them.\n */\nexport function useQuery<MT extends ModelType>(repo: Repository<MT>, repos: Repos|null=null, opts: IQueryFetch<MT>) {\n    const query = new Query(repo, repos, opts)\n    const state = State.none()\n\n    async function fetch(opts: IQueryFetch<MT>) {\n        state.processing()\n        let resp = null\n        try {\n            resp = await query.fetch(opts)\n            state.none()\n        }\n        catch(error) {\n            state.error(error)\n        }\n        return resp\n    }\n    return {state, query, fetch}\n}\n\n\n/**\n * This composable create an new Editor and returns it as reactive object.\n *\n * - provide: {@link Editor} `editor`, computed value `edited`.\n * - set default `saved` method if emits is provided\n * - watch on edition to update panel's editions\n *\n * @param {IEditor} options - editor options;\n * @param cls - class to instanciate the editor;\n */\nexport function useEditor<\n    T extends Record<string, any>,\n    P extends IEditorProps<T>,\n>(\n    options: IEditor<T,P>,\n    cls: typeof Editor<T,P>=Editor<T,P>\n)\n{\n    const initial = options.initial || options.props.initial\n    const editor = reactive(new cls(options))\n\n    provide('editor', editor)\n\n    const edited = computed(() => editor.isEdited())\n    watch(() => editor.props.initial, (val: UnwrapRef<T>) => {\n        const value : UnwrapRef<T> = val || editor.empty\n        editor.initial = value\n        editor.reset(value as T)\n    })\n\n    const panel = inject('panel') as Panel\n    if(panel)\n        watch(() => editor.edited, (val: boolean) => panel.setEdition(editor.name, val))\n\n    return {editor, edited}\n}\n\n/**\n * Return a new reactive {@link ModelEditor}.\n * Wrapper around {@link useEditor}.\n */\nexport function useModelEditor<\n    T extends Model,\n    P extends IModelEditorProps<T>\n>(\n    options: IEditor<T,P>,\n    cls: typeof ModelEditor<T,P> = ModelEditor<T,P>\n)\n{\n    return useEditor(options, cls)\n}\n","import {t} from '../composables'\n\nexport type Rule = (value: any) => boolean|string\n\n/**\n * This object provide commonly used validation rules to use with form fields.\n *\n * Some of the functions declared are not actual Rule, but return one to use instead.\n */\nexport default {\n    /** Field is required */\n    required(value: any) : boolean|string {\n        return value || value === 0 ? true : t('fields._.required')\n    },\n\n    /**\n     * Return a rule validating field errors returned from the server based\n     * on the provided error list.\n     */\n    errors(errorList: string[]|null|undefined) : Rule {\n        return () => (errorList?.length ? errorList.join('<br>') || false : true)\n    },\n\n    /**\n     * Return a rule whose validating value is optional.\n     *\n     * By default rules require value to be provided. This returns a new\n     * rule whose value can either be empty or must match provided rule.\n     */\n    optional(rule: any) : Rule {\n        return (value: any) => (!value || rule(value))\n    },\n\n    /** Rule validating email */\n    email(value: string) : boolean|string {\n        const allowed = /^(([^<>()[\\]\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@(([^<>()[\\]\\.,;:\\s@\\\"]+\\.)+[^<>()[\\]\\.,;:\\s@\\\"]{2,})$/i\n        return allowed.test(value) || t(\"fields.email.rule\")\n    },\n\n    /** Rule validating username */\n    username(value: string) : boolean|string {\n        const allowed = /^[A-Za-z0-9@.+\\-_]+$/\n        return allowed.test(value) || \"Username must not be empty. It only can contain letters, numbers and @/+/./- special characters\"\n    },\n\n    /** Rule validating url for HTTP protocol */\n    httpUrl(value: string) : boolean|string {\n        const allowed = /https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?&//=]*)/\n        return allowed.test(value) || t(\"rules.http_url\")\n    },\n\n\n    /** Rule validating url for other protocols */\n    url(value: string) : boolean|string {\n        const allowed = /[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?&//=]*)/\n        return allowed.test(value) || t(\"rules.url\")\n    },\n}\n","import { defineAsyncComponent as $defineAsyncComponent } from 'vue'\n\nexport * from './app'\nexport * from './actions'\nexport * from './init'\nexport * from './i18n'\nexport * from './models'\nexport * from './controllers'\nexport {default as rules} from './rules'\n\n\n/**\n * Similar to `defineAsyncComponent` but using url string to module\n * file.\n *\n * It will try to fetch related css file (based on module file).\n */\nexport function defineAsyncComponent(url: string, name: string) {\n    return $defineAsyncComponent(() => {\n        return import(url).then(mod => {\n            // try to fetch css\n            if(url.endsWith('.js'))\n                loadCss(import.meta.resolve(url.replace(/\\.js$/, '.css')))\n            if(!name)\n                return mod\n\n            const obj = Object.values(mod).filter((y: {[k: string]: any}) => y.__name == name)[0]\n            return obj\n        })\n    })\n}\n\n/** Load CSS. */\nfunction loadCss(href: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n        if (document.querySelector(`link[href=\"${href}\"]`)) {\n            resolve()\n            return\n        }\n\n        const link = document.createElement('link')\n        link.rel = 'stylesheet'\n        link.href = href\n        link.onload = () => resolve()\n        link.onerror = (err) => reject(err)\n\n        document.head.appendChild(link)\n    })\n}\n\n\n/**\n * This exception is used in order to display the message to user\n * when it is raised.\n */\nclass UserError extends Error {}\n"],"names":["toString","prefix","prop","key","val","t","enumProxy","target","receiver","k","Enum","fields","Response","repository","config","response","__publicField","data","method","result","action","Request","actions","_a","_c","_b","name","url","requestConfig","axiosResponse","AxiosRepository","Repository","database","pinia","useAxiosApi","axios","createPiniaOrmAxios","axiosConfig","definePiniaOrmPlugin","context","_RefCounter","repo","ids","id","tags","drop","pull","releaseIds","acquireIds","difference","idx","RefCounter","RefRepository","asRelation","relation","field","Relation","getSourceKey","HasMany","HasManyBy","HasOne","BelongsTo","useRepo","model","$useRepo","getActivePinia","useModels","models","useInject","useDefaults","repos","inject","injected","User","provide","AppContext","opts","obj","reactive","computed","State","value","dataEl","el","useAppContext","load","useAction","props","user","emits","processing","ref","allowed","args","init","App","onLoad","options","initApp","app","createApp","vm","resolve","vuetify","plugins","$createApp","createVuetify","i18n","useI18n","plugin","components","defaults","vendorComponents","$createVuetify","md3","colors","createPinia","baseURL","$createPinia","piniaOrm","createORM","setActivePinia","Query","lookup","params","relations","path","_id","_e","_d","dat","nextKey","limit","result2","objs","entities","funcName","rel","repo2","fk","collectAttr","query","Editor","assignNonEmpty","reset","isEqual","Config","state","cloneDeep","item","_","Panel","edited","view","silent","force","msg","Panels","search","panel","child","href","ModelController","error","ModelList","index","step","sibling","append","map","union","items","v","ModelEditor","pick","cls","func","ModelPanel","list","tKeys","usePanels","panels","onMounted","event","initialTitle","watch","usePanel","onUnmounted","useModelPanel","useModelList","next","unref","prev","listId","ifNotEqualFn","old","useQuery","fetch","resp","useEditor","editor","useModelEditor","rules","errorList","rule","defineAsyncComponent","$defineAsyncComponent","mod","loadCss","y","reject","link","err"],"mappings":"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","x_google_ignoreList":[1]}
